<!DOCTYPE html>
<html>
  <head>
    <title>Package 'proxistat' reference manual</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <!-- styling for math and syntax -->
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/katex.min.css">
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/R.css">
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/prism.css">

    <!-- for (future) customizations -->
    <script src="https://r-universe.dev/static/manual.js"></script>
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/manual.css?nocache=1">

  </head>

  <body class="macintosh">
    <h1 class="manual-title">Package 'proxistat'</h1>
    <table class="description-table">
      <tr>
<th>Title:</th>
<td class="description-title">Create a Proximity Score in Each Census Unit, Based on Distances to
Specified Points (as in EPA's EJScreen tool, for example)</td>
</tr>
      <tr>
<th>Description:</th>
<td class="description-description">This package can create a proximity score for each spatial unit 
    like a Census block or block group or tract, to quantify the distances to -- 
    and the distance-weighted count of -- nearby points of interest.
    Those specified geographic points could be sources of air pollution, for example, 
    where greater proximity could be a simple proxy for greater risk of exposure. 
    The points could alternatively be amenities, where greater proximity is better. 
    These proximity scores can be used in environmental justice (EJ) analysis
    to analyze the distribution of or mean of proximities to hazardous waste sites, 
    by community or for each demographic group. For example, one could explore 
    whether and to what degree the average Hispanic or Latino individual compared to the 
    rest of the US population on average lives closer to hazardous waste
    treatment, storage, or disposal facilities. 
    Key functions: 
    get.distances() finds distances quickly within an optional search radius
    get.distances.all() to find distances from all frompoints to alltopoints. 
    The function proxistat() creates a proximity score that quantifies, for each spatial
    unit like a Census block group, how many topoints are nearby and how close
    they are.
    This package uses the sp package for the basic distance calculation 
    (and also had older functions to calculate distances).
    Also see the EJAM package in development by EPA, for fast distance stats.
    -distances between all points (from one list of points to another), 
    -distances to all points found within some maximum search radius, 
    -distance to and identity of the nearest single point, etc.
    For any imported/suggested packages not on CRAN, see http://ejanalysis.github.io</td>
</tr>
      <tr>
<th>Authors:</th>
<td class="description-author"><span>info@ejanalysis.com</span></td>
</tr>
      <tr>
<th>Maintainer:</th>
<td class="description-maintainer">info@ejanalysis.com &lt;info@ejanalysis.com&gt;</td>
</tr>
      <tr>
<th>License:</th>
<td class="description-license">MIT + file LICENSE</td>
</tr>
      <tr>
<th>Version:</th>
<td class="description-version">2.1</td>
</tr>
      <tr>
<th>Built:</th>
<td class="description-date">2023-01-29 23:09:43 UTC</td>
</tr>
      <tr>
<th>Source:</th>
<td class="description-source">GitHub</td>
</tr>
    </table>

    <a href="#help-index" style="color:black;"><h2 id="help-index">Help Index</h2></a>
    <ul id="help-index-list">
<li class="help-index-item"><a href="#%20***%20PACKAGE%20OVERVIEW:%20proxistat-package"> *** PACKAGE OVERVIEW: proxistat-package - Find Distances between lat lon Points or Create Proximity Scores.</a></li>
<li class="help-index-item"><a href="#proxistat-package">proxistat-package - Find Distances between lat lon Points or Create Proximity Scores.</a></li>
<li class="help-index-item"><a href="#bg.pts">bg.pts - Block group internal points from Census Bureau for 2020 geographies</a></li>
<li class="help-index-item"><a href="#blockpoints_area_pop">blockpoints_area_pop - Block points from Census Bureau for 2020 geographies</a></li>
<li class="help-index-item"><a href="#compile.dbfs">compile.dbfs - Read a series of dbf files and join compile them as a single data.frame</a></li>
<li class="help-index-item"><a href="#convert">convert - Convert units of distance or area</a></li>
<li class="help-index-item"><a href="#countiesall">countiesall - Counties information from U.S. Census Bureau from 2022</a></li>
<li class="help-index-item"><a href="#county.pts">county.pts - approx lat lon of each US County by FIPS - 2020
A dataset containing latitude and longitude approx of each US county,
created as average lat and average lon of all block group internal points.</a></li>
<li class="help-index-item"><a href="#countypointmap">countypointmap - Simple map of color-coded counties, wrapper for county_choropleth</a></li>
<li class="help-index-item"><a href="#deg2rad">deg2rad - Convert degrees to radians</a></li>
<li class="help-index-item"><a href="#deltalon.per.km">deltalon.per.km - Convert kilometers (East-West) to degrees longitude.</a></li>
<li class="help-index-item"><a href="#gcd">gcd - Distance between two points by Haversine, Spherical Law of Cosines, or Vincenty inverse formula</a></li>
<li class="help-index-item"><a href="#gcd.hf">gcd.hf - Distance based on Haversine formula</a></li>
<li class="help-index-item"><a href="#gcd.slc">gcd.slc - Distance based on spherical law of cosines</a></li>
<li class="help-index-item"><a href="#get.bg.latlons">get.bg.latlons - Was used to get block group internal points directly from Census shapefiles</a></li>
<li class="help-index-item"><a href="#get.distances">get.distances - Find distances between nearby points, within specified radius.</a></li>
<li class="help-index-item"><a href="#get.distances.all">get.distances.all - Find all distances between two sets of points (based on lat/lon)</a></li>
<li class="help-index-item"><a href="#get.distances.chunked">get.distances.chunked - Call a function once per chunk &amp; save output as file (breaks large input data into chunks)</a></li>
<li class="help-index-item"><a href="#get.distances.prepaired">get.distances.prepaired - Find distances between points, for pairs of points already organized as pairs.</a></li>
<li class="help-index-item"><a href="#get.nearest">get.nearest - Find distance from each point in a set to the nearest of a second set of points (by lat/lon).</a></li>
<li class="help-index-item"><a href="#latlon.colnames.check">latlon.colnames.check - obsolete - see latlon_is.valid()</a></li>
<li class="help-index-item"><a href="#latlon_is.valid">latlon_is.valid - Validate latitudes and longitudes</a></li>
<li class="help-index-item"><a href="#linesegments">linesegments - Add line segments connecting pairs of points, to a plot</a></li>
<li class="help-index-item"><a href="#lookup.states">lookup.states - States and related areas dataset</a></li>
<li class="help-index-item"><a href="#meters.per.degree.lat">meters.per.degree.lat - Convert degrees latitude to meters North-South.</a></li>
<li class="help-index-item"><a href="#meters.per.degree.lon">meters.per.degree.lon - Convert degrees longitude to meters East-West.</a></li>
<li class="help-index-item"><a href="#near_eachother">near_eachother - which points are near any of the others in list?</a></li>
<li class="help-index-item"><a href="#pointmap">pointmap - Read a series of dbf files and join compile them as a single data.frame</a></li>
<li class="help-index-item"><a href="#proxistat">proxistat - Proximity Statistic for Each Location and Nearby Points</a></li>
<li class="help-index-item"><a href="#proxistat.assemble.chunks">proxistat.assemble.chunks - read files storing proxistat result chunks and assemble into one result</a></li>
<li class="help-index-item"><a href="#proxistat.chunked">proxistat.chunked - Call proxistat once per chunk &amp; save output as file (breaks large input data into chunks)</a></li>
<li class="help-index-item"><a href="#proxistat.rollup">proxistat.rollup - Convert Census Block Proximity Statistics to Block Group Statistics</a></li>
<li class="help-index-item"><a href="#speedsummary">speedsummary - Print summary of speed in buffers per hour, given start and end times of batch</a></li>
<li class="help-index-item"><a href="#testpoints">testpoints - Generate a number of randomly placed points, as latitude/longitude values.</a></li>
<li class="help-index-item"><a href="#testpoints_bg22">testpoints_bg22 - Get lat lon for random US census block groups (where avg person lives or other weighting)</a></li>
<li class="help-index-item"><a href="#testpoints_block2010">testpoints_block2010 - Get lat lon for random US census blocks (where avg person lives or other weighting)</a></li>
<li class="help-index-item"><a href="#testpoints_block2020">testpoints_block2020 - Get lat lon pop and area for random US census blocks (where avg person lives or other weighting)</a></li>
</ul>

    <hr>
    <div class="manual-pages-content">
<div class="container manual-page" id=" *** PACKAGE OVERVIEW: proxistat-package">

<a href="#%20***%20PACKAGE%20OVERVIEW:%20proxistat-package" class="help-page-title"><h2>Find Distances between lat lon Points or Create Proximity Scores.</h2></a>

<h3>Description</h3>

<p>This package has functions helping to calculate distances between points,
such as the distances between all points,
distances to all points within some maximum distance,
distance to nearest single point, etc.
It also can create a proximity score for each spatial unit like a
Census block group, to quantify the distance-weighted count of nearby
points.
</p>


<h3>Details</h3>

<p>This package has functions helping to calculate distances between
geographic points, such as the distances between all points, distances to
all points within some maximum distance, distance to nearest single point,
etc. It also can create a proximity score for each spatial unit like a
Census block group, to quantify the distance-weighted count of nearby
points. This proximity score can be used in environmental justice (EJ)
analysis, for example.
</p>
<p>This package relies on the <span class="pkg">sp</span> package for the actual calculation of distance.
</p>
<p>A vector of points can be specified using a data.frame of two columns, "lat" and "lon"
which specify latitude and longitude in decimal degrees.
It returns the distances from one or more <code>frompoints</code> to one or more <code>topoints</code>.<br><br>
Key functions include <br></p>

<ul>
<li> <p><code><a href="#get.nearest">get.nearest</a></code> to find the one among <code>topoints</code> nearest each <code>frompoints</code>
</p>
</li>
<li> <p><code><a href="#get.distances">get.distances</a></code> to find distances quickly within an optional search radius
</p>
</li>
<li> <p><code><a href="#proxistat">proxistat</a></code> to create a proximity score that quantifies,
for each spatial unit like a Census block group,
how many <code>topoints</code> are nearby and how close they are
</p>
</li>
<li> <p><code><a href="#convert">convert</a></code> to convert units (miles, km)
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>info@ejanalysis.com&lt;info@ejanalysis.com&gt;
</p>


<h3>References</h3>

<p><a href="http://ejanalysis.github.io" target="_blank">http://ejanalysis.github.io</a> <br><a href="http://www.ejanalysis.com/" target="_blank">http://www.ejanalysis.com/</a> <br><span class="pkg">sp</span> package documentation for basic distance function.<br>
Some discussion of this type of proximity indicator is available in the EJSCREEN mapping tool documentation: <br>
U.S. Environmental Protection Agency (2015). EJSCREEN Technical Documentation. 
<a href="http://www.epa.gov/ejscreen" target="_blank">http://www.epa.gov/ejscreen</a><br><a href="http://en.wikipedia.org/wiki/Longitude" target="_blank">http://en.wikipedia.org/wiki/Longitude</a> and <a href="http://en.wikipedia.org/wiki/Decimal_degrees" target="_blank">http://en.wikipedia.org/wiki/Decimal_degrees</a>
</p>


<h3>See Also</h3>

<p><span class="pkg">sp</span>, US block points dataset: <a href="http://ejanalysis.github.io/UScensus2010blocks/" target="_blank">http://ejanalysis.github.io/UScensus2010blocks/</a>, <code><a href="#deltalon.per.km">deltalon.per.km</a></code>, <code><a href="#deltalon.per.km">deltalon.per.km</a></code>, <code><a href="#meters.per.degree.lat">meters.per.degree.lat</a></code>, <code><a href="#meters.per.degree.lon">meters.per.degree.lon</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">test.from <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>fromlat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9567309094</span><span class="token punctuation">,</span> <span class="token number">38.9507043428</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  fromlon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0896572305</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0896199948</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span><span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"6054762"</span><span class="token punctuation">,</span> <span class="token string">"6054764"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">)</span>
test.to <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>tolat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9575019287</span><span class="token punctuation">,</span> <span class="token number">38.9507043428</span><span class="token punctuation">,</span> <span class="token number">38.9514152435</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  tolon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0892818598</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0896199948</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0972395245</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span><span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"6054762"</span><span class="token punctuation">,</span> <span class="token string">"6054763"</span><span class="token punctuation">,</span> <span class="token string">"6054764"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  setseed<span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span>
t100<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
t10<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
t3<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

get.distances<span class="token punctuation">(</span>
  test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">,</span> return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span>
<span class="token punctuation">)</span>
get.nearest<span class="token punctuation">(</span>test.from<span class="token punctuation">,</span> test.to<span class="token punctuation">)</span>

get.distances<span class="token punctuation">(</span>  t3<span class="token punctuation">,</span> t10<span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">,</span> return.crosstab<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>  t3<span class="token punctuation">,</span> t10<span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>  t3<span class="token punctuation">,</span> t10<span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>
proxistat<span class="token punctuation">(</span>t3<span class="token punctuation">,</span> t10<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">,</span> units <span class="token operator">=</span> <span class="token string">"km"</span><span class="token punctuation">,</span> area <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">100001</span><span class="token operator">:</span><span class="token number">100003</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
proxistat<span class="token punctuation">(</span>  t3<span class="token punctuation">,</span> t10<span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>
<span class="token number">1</span><span class="token operator">/</span>get.nearest<span class="token punctuation">(</span>   t3<span class="token punctuation">,</span> t10<span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="proxistat-package">

<a href="#proxistat-package" class="help-page-title"><h2>Find Distances between lat lon Points or Create Proximity Scores.</h2></a>

<h3>Description</h3>

<p>This package has functions helping to calculate distances between points,
such as the distances between all points,
distances to all points within some maximum distance,
distance to nearest single point, etc.
It also can create a proximity score for each spatial unit like a
Census block group, to quantify the distance-weighted count of nearby
points.
</p>


<h3>Details</h3>

<p>This package has functions helping to calculate distances between
geographic points, such as the distances between all points, distances to
all points within some maximum distance, distance to nearest single point,
etc. It also can create a proximity score for each spatial unit like a
Census block group, to quantify the distance-weighted count of nearby
points. This proximity score can be used in environmental justice (EJ)
analysis, for example.
</p>
<p>This package relies on the <span class="pkg">sp</span> package for the actual calculation of distance.
</p>
<p>A vector of points can be specified using a data.frame of two columns, "lat" and "lon"
which specify latitude and longitude in decimal degrees.
It returns the distances from one or more <code>frompoints</code> to one or more <code>topoints</code>.<br><br>
Key functions include <br></p>

<ul>
<li> <p><code><a href="#get.nearest">get.nearest</a></code> to find the one among <code>topoints</code> nearest each <code>frompoints</code>
</p>
</li>
<li> <p><code><a href="#get.distances">get.distances</a></code> to find distances quickly within an optional search radius
</p>
</li>
<li> <p><code><a href="#proxistat">proxistat</a></code> to create a proximity score that quantifies,
for each spatial unit like a Census block group,
how many <code>topoints</code> are nearby and how close they are
</p>
</li>
<li> <p><code><a href="#convert">convert</a></code> to convert units (miles, km)
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>info@ejanalysis.com&lt;info@ejanalysis.com&gt;
</p>


<h3>References</h3>

<p><a href="http://ejanalysis.github.io" target="_blank">http://ejanalysis.github.io</a> <br><a href="http://www.ejanalysis.com/" target="_blank">http://www.ejanalysis.com/</a> <br><span class="pkg">sp</span> package documentation for basic distance function.<br>
Some discussion of this type of proximity indicator is available in the EJSCREEN mapping tool documentation: <br>
U.S. Environmental Protection Agency (2015). EJSCREEN Technical Documentation. 
<a href="http://www.epa.gov/ejscreen" target="_blank">http://www.epa.gov/ejscreen</a><br><a href="http://en.wikipedia.org/wiki/Longitude" target="_blank">http://en.wikipedia.org/wiki/Longitude</a> and <a href="http://en.wikipedia.org/wiki/Decimal_degrees" target="_blank">http://en.wikipedia.org/wiki/Decimal_degrees</a>
</p>


<h3>See Also</h3>

<p><span class="pkg">sp</span>, US block points dataset: <a href="http://ejanalysis.github.io/UScensus2010blocks/" target="_blank">http://ejanalysis.github.io/UScensus2010blocks/</a>, <code><a href="#deltalon.per.km">deltalon.per.km</a></code>, <code><a href="#deltalon.per.km">deltalon.per.km</a></code>, <code><a href="#meters.per.degree.lat">meters.per.degree.lat</a></code>, <code><a href="#meters.per.degree.lon">meters.per.degree.lon</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">test.from <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>fromlat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9567309094</span><span class="token punctuation">,</span> <span class="token number">38.9507043428</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  fromlon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0896572305</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0896199948</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span><span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"6054762"</span><span class="token punctuation">,</span> <span class="token string">"6054764"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">)</span>
test.to <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>tolat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9575019287</span><span class="token punctuation">,</span> <span class="token number">38.9507043428</span><span class="token punctuation">,</span> <span class="token number">38.9514152435</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  tolon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0892818598</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0896199948</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0972395245</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span><span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"6054762"</span><span class="token punctuation">,</span> <span class="token string">"6054763"</span><span class="token punctuation">,</span> <span class="token string">"6054764"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  setseed<span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span>
t100<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
t10<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
t3<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

get.distances<span class="token punctuation">(</span>
  test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">,</span> return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span>
<span class="token punctuation">)</span>
get.nearest<span class="token punctuation">(</span>test.from<span class="token punctuation">,</span> test.to<span class="token punctuation">)</span>

get.distances<span class="token punctuation">(</span>  t3<span class="token punctuation">,</span> t10<span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">,</span> return.crosstab<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>  t3<span class="token punctuation">,</span> t10<span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>  t3<span class="token punctuation">,</span> t10<span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>
proxistat<span class="token punctuation">(</span>t3<span class="token punctuation">,</span> t10<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">,</span> units <span class="token operator">=</span> <span class="token string">"km"</span><span class="token punctuation">,</span> area <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">100001</span><span class="token operator">:</span><span class="token number">100003</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
proxistat<span class="token punctuation">(</span>  t3<span class="token punctuation">,</span> t10<span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>
<span class="token number">1</span><span class="token operator">/</span>get.nearest<span class="token punctuation">(</span>   t3<span class="token punctuation">,</span> t10<span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="bg.pts">

<a href="#bg.pts" class="help-page-title"><h2>Block group internal points from Census Bureau for 2020 geographies</h2></a>

<h3>Description</h3>

<p>The population weighted mean of block internal points, 
within each block group.
</p>


<h3>Format</h3>

<p>A data.frame of block groups, with these variables: <br><br></p>
<pre>
'data.frame':	242335 obs. of  5 variables:
 $ FIPS      : chr  "010010201001" "010010201002" "010010202001" "010010202002" ...
 $ lat       : num  32.5 32.5 32.5 32.5 32.5 ...
 $ lon       : num  -86.5 -86.5 -86.5 -86.5 -86.5 ...
 $ bgid      : int  1 2 3 4 5 6 7 8 9 10 ...
 $ blockcount: int  26 30 14 27 21 21 16 29 29 18 ...
 - attr(*, "census_version")= num 2020
 - attr(*, "acs_version")= chr "2016-2020"
 - attr(*, "acs_releasedate")= chr "3/17/2022"
 - attr(*, "ejscreen_version")= chr "2.1"
 - attr(*, "ejscreen_releasedate")= chr "October 2022"
 - attr(*, "ejscreen_pkg_data")= chr "bg22"
</pre>


<h3>Details</h3>

<p>This data set provides a data.frame with 242,335 block groups, with 5 variables.
It has PR but lacks "AS" "GU" "MP" "VI" 
The population weighted mean not spatial mean was used
to summarize the lat lon values of all Census 2020 blocks in a given block group.
</p>


<h3>Source</h3>

<p>Derived from Census Bureau, obtained 10/2022. 
bg.pts &lt;- as.data.frame(copy(EJAM::bgpts)) # see EJAM package for details 
names(bg.pts) &lt;- c('bgid', 'lat','lon','FIPS','blockcount')
bg.pts &lt;- bg.pts[ , c('FIPS', 'lat', 'lon', 'bgid', 'blockcount')]
bg.pts &lt;- metadata_add(bg.pts)
usethis::use_data(bg.pts)
</p>


<h3>See Also</h3>

<p><span class="pkg">EJAM::proxistat2</span>  <span class="pkg">EJAM::bgpts</span> and  <span class="pkg">acs</span>  and for older data <span class="pkg">UScensus2010blocks</span>
</p>

<hr>
</div>
<div class="container manual-page" id="blockpoints_area_pop">

<a href="#blockpoints_area_pop" class="help-page-title"><h2>Block points from Census Bureau for 2020 geographies</h2></a>

<h3>Description</h3>

<p>data.table columns are: blockfips, lat, lon, pop, area, blockid
</p>


<h3>Details</h3>

<p>Area is in square meters. 
This data set provides a data.table with 8,132,968 blocks  
It has PR but lacks "AS" "GU" "MP" "VI"
</p>


<h3>Source</h3>

<p>Derived from Census Bureau, obtained 10/2022.
</p>

<hr>
</div>
<div class="container manual-page" id="compile.dbfs">

<a href="#compile.dbfs" class="help-page-title"><h2>Read a series of dbf files and join compile them as a single data.frame</h2></a>

<h3>Description</h3>

<p>Can help with a series of downloaded Census data files, such as one file per State. 
Reads each using <code><a href="https://r-universe.dev/manuals/foreign.html#read.dbf">read.dbf</a></code> and combines them all as a data.frame.
They must all have the same columns, and each file just provides additional rows of data.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">compile.dbfs<span class="token punctuation">(</span>filepaths<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>filepaths</code></td>
<td>
<p>Required charater vector with full paths including file names of dbf files to be read.</p>
</td>
</tr></table>
<h3>Value</h3>

<p>Returns a data.frame with as many columns as each dbf file, and as many rows as there are in all the dbf files read in.
</p>


<h3>See Also</h3>

<p><code><a href="https://r-universe.dev/manuals/foreign.html#read.dbf">read.dbf</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="convert">

<a href="#convert" class="help-page-title"><h2>Convert units of distance or area</h2></a>

<h3>Description</h3>

<p><code>convert</code> converts distance/length or area from specified units to other specified units.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">convert<span class="token punctuation">(</span>x<span class="token punctuation">,</span> from <span class="token operator">=</span> <span class="token string">"km"</span><span class="token punctuation">,</span> towhat <span class="token operator">=</span> <span class="token string">"mi"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A number or vector of numbers to be converted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>from</code></td>
<td>
<p>A string specifying original units of input parameter. Default is 'km' which is kilometers.
Note all must be in the same units.
Units can be specified as any of the following: 
c(
'millimeter', 'millimeters', 'centimeter', 'centimeters', 'meter', 'meters', 'kilometer', 'kilometers',
"mm", "cm", "m", "km",
"sqmm", "sqcm", "sqm", "sqkm", 
"mm2", "cm2", "m2", "km2", 
'inch', 'inches', 'foot', 'feet', 'yard', 'yards', 'mile', 'miles',
"in", "ft", "yd", "mi", 
"sqin", "sqft", "sqyd", "sqmi",
"in2", 'ft2', 'yd2', 'mi2'
)
Note that m2 is for square meters not square miles.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>towhat</code></td>
<td>
<p>A strings specifying new units to convert to. Default is 'mi' which is miles.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function takes a number, or vector of numbers, representing distance/length or area
in one type of specified units, such as miles, and returns the corresponding number(s)
converted to some other units, such as kilometers. Units can be specified in various ways.
All inputs must be in the same units. All outputs must be in a single set of units as well. <br><br>
NOTE: For some purposes, Census Bureau does this: "The ANSI standard for converting square kilometers into square miles was used ( 1 square mile = 2.58998811 square kilometers)." 
(see <a href="https://www.census.gov/geo/reference/state-area.html" target="_blank">https://www.census.gov/geo/reference/state-area.html</a>)
but the conversions in this function use 2.5899881034 not 2.58998811 sqkm/sqmi. 
The difference is only 6.6 per billion (roughly 1 in 152 million), which is less than one tenth of a square kilometer out the entire USA.
</p>


<h3>Value</h3>

<p>Returns a number or vector of numbers then length of the input x, 
with each element corresponding to an input element converted to new units.
</p>


<h3>See Also</h3>

<p><code><a href="#get.distances">get.distances</a></code> which allows you to specify a search radius and 
get distances only within that radius, and related functions.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">convert<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mi'</span><span class="token punctuation">,</span> <span class="token string">'km'</span><span class="token punctuation">)</span>
convert<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1e6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'sqm'</span><span class="token punctuation">,</span> <span class="token string">'sqkm'</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="countiesall">

<a href="#countiesall" class="help-page-title"><h2>Counties information from U.S. Census Bureau from 2022</h2></a>

<h3>Description</h3>

<p>Names and FIPS codes for U.S. Counties/County equivalents. 
It has Puerto Rico but not American Samoa, Guam, Mariana Islands, and US Virgin Islands.
"AS" "GU" "MP" "PR" "VI"
</p>


<h3>Format</h3>

<p>A data.frame of 3221 U.S. Counties or County equivalents, with 5 variables. <br><br>
&gt; str(countiesall) <br>
'data.frame':	3221 obs. of  5 variables:
</p>

<ul>
<li>
<p>  $ ST         : chr  "AL" "AL" "AL" "AL" ...
</p>
</li>
<li>
<p>  $ FIPS.COUNTY: chr  "01001" "01003" "01005" "01007" ...
</p>
</li>
<li>
<p>  $ countyname : chr  "Autauga County" "Baldwin County" "Barbour County" "Bibb County" ...
</p>
</li>
<li>
<p>  $ statename  : chr  "Alabama" "Alabama" "Alabama" "Alabama" ...
</p>
</li>
<li>
<p>  $ fullname   : chr  "Autauga County, Alabama" "Baldwin County, Alabama" "Barbour County, Alabama" "Bibb County, Alabama" ...
</p>
</li>
</ul>
<p><code>&gt; head(countiesall) <br><br>
  ST FIPS.COUNTY     countyname statename                fullname<br>
1 AL       01001 Autauga County   Alabama Autauga County, Alabama<br>
2 AL       01003 Baldwin County   Alabama Baldwin County, Alabama<br>
3 AL       01005 Barbour County   Alabama Barbour County, Alabama<br></code>
</p>


<h3>Details</h3>

<p>For how the 2022 version of proxistat::countiesall was created, 
see   proxistat/inst/SCRIPT_make_countiesall_county_names.R
</p>


<h3>See Also</h3>

<p><code><a>get.county.info</a></code> from the <span class="pkg">ejanalysis</span> package (<a href="http://ejanalysis.github.io/ejanalysis/" target="_blank">http://ejanalysis.github.io/ejanalysis/</a>), 
and maybe the <span class="pkg">acs</span> package
</p>

<hr>
</div>
<div class="container manual-page" id="county.pts">

<a href="#county.pts" class="help-page-title"><h2>approx lat lon of each US County by FIPS - 2020
A dataset containing latitude and longitude approx of each US county,
created as average lat and average lon of all block group internal points.</h2></a>

<h3>Description</h3>

<p>approx lat lon of each US County by FIPS - 2020
A dataset containing latitude and longitude approx of each US county,
created as average lat and average lon of all block group internal points.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">county.pts</code></pre>


<h3>Format</h3>

<p>A data frame with one row per county and FIPS.COUNTY, lat, lon as colnames
</p>


<h3>Details</h3>

<pre>
 Creating county.pts from bg.pts to get lat lon of middle roughly of county from block group lat lon dataset: 
 
countylat &lt;- aggregate(bg.pts$lat, by = list(substr(bg.pts$FIPS, 1, 5)), FUN = mean) 
countylon &lt;- aggregate(bg.pts$lon, by = list(substr(bg.pts$FIPS, 1, 5)), FUN = mean) 
countyfips &lt;- countylat$Group.1 
countylat  &lt;- countylat$x 
countylon  &lt;- countylon$x 
county.pts &lt;- data.frame(FIPS.COUNTY = countyfips, lat = countylat, lon = countylon, stringsAsFactors = FALSE) 

 plot(bg.pts$lon, bg.pts$lat, pch = '.', col='gray', xlim = c(-170,-60), ylim = c(18, 75)) 
 points(county.pts$lon, county.pts$lat, pch = '.', col='red')
 text(lookup.states$lon, lookup.states$lat, labels = lookup.states$ST, cex = 0.6)
 
 Also see https://www2.census.gov/geo/docs/maps-data/data/gazetteer/2020_Gazetteer/2020_Gaz_counties_national.zip
  </pre>

<hr>
</div>
<div class="container manual-page" id="countypointmap">

<a href="#countypointmap" class="help-page-title"><h2>Simple map of color-coded counties, wrapper for county_choropleth</h2></a>

<h3>Description</h3>

<p>very simple mapping of color coded map of US counties.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">countypointmap<span class="token punctuation">(</span>
  x<span class="token punctuation">,</span>
  query <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  state_zoom <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  title <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span>
  num_colors <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>required vector of numeric values to plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>flexible way to define what locations - default is all US counties.
Can be a set of countyfips or full names like Cook County IL or even one or more states -
See <code><a>get.county.info</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>state_zoom</code></td>
<td>
<p>optional but more flexible than in county_choropleth, which requires it be 
the full state name all lowercase. This function instead accepts case-insensitive state name
or two letter state abbreviation or state fips as number or text.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>title</code></td>
<td>
<p>required, used in <code><a href="https://arilamstein.r-universe.dev/choroplethr/doc/manual.html#county_choropleth">county_choropleth</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_colors</code></td>
<td>
<p>Default is 1 (unlike default in county_choroplethr) for graded colors to show outliers well, passed to <code><a href="https://arilamstein.r-universe.dev/choroplethr/doc/manual.html#county_choropleth">county_choropleth</a></code> . Max allowed is 9.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional parameters like state_zoom (but in ), to pass to <code><a href="https://arilamstein.r-universe.dev/choroplethr/doc/manual.html#county_choropleth">county_choropleth</a></code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This is just a wrapper for <code><a href="https://arilamstein.r-universe.dev/choroplethr/doc/manual.html#county_choropleth">county_choropleth</a></code> 
but it is much more flexible in how the counties are specified.
While <code><a href="https://arilamstein.r-universe.dev/choroplethr/doc/manual.html#county_choropleth">county_choropleth</a></code> requires statecounty fips numbers, 
and zooms in on a state defined by 2-digit fips, 
this wrapper lets you specify counties by full name like Cook County IL
or even one or more states.
It is buggy as drafted, however.
</p>
<p>Also note acs package is useful such as for
county_choropleth_acs('B01001', endyear = 2018, state_zoom = 'new york')
</p>


<h3>Value</h3>

<p>Just draws a map
</p>


<h3>See Also</h3>

<p><code><a href="https://arilamstein.r-universe.dev/choroplethr/doc/manual.html#county_choropleth">county_choropleth</a></code> <code><a href="#pointmap">pointmap</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="deg2rad">

<a href="#deg2rad" class="help-page-title"><h2>Convert degrees to radians</h2></a>

<h3>Description</h3>

<p>From <a href="http://www.r-bloggers.com/great-circle-distance-calculations-in-r/" target="_blank">http://www.r-bloggers.com/great-circle-distance-calculations-in-r/</a>
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">deg2rad<span class="token punctuation">(</span>deg<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>deg</code></td>
<td>
<p>Degrees as decimal degrees, required numeric vector</p>
</td>
</tr></table>
<h3>Value</h3>

<p>Radians, as numeric vector same length as input
</p>

<hr>
</div>
<div class="container manual-page" id="deltalon.per.km">

<a href="#deltalon.per.km" class="help-page-title"><h2>Convert kilometers (East-West) to degrees longitude.</h2></a>

<h3>Description</h3>

<p><code>deltalon.per.km</code> returns change in decimal degrees longitude per kilometer (East-West), given latitude (Northern Hemisphere).
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">deltalon.per.km<span class="token punctuation">(</span>lat<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>The decimal degrees of latitude of the Northern Hemisphere location(s) of interest, as number or vector of numbers.</p>
</td>
</tr></table>
<h3>Details</h3>

<p>This function returns the change in decimal degrees longitude per kilometer moving East-West, at a given latitude (N. Hemisphere).
This is an approximation and is less accurate further from the given latitude.
The degrees of longitude per km traveled East-West is larger closer to the poles, and smallest at the equator.
See <a href="http://en.wikipedia.org/wiki/Longitude" target="_blank">http://en.wikipedia.org/wiki/Longitude</a> and <a href="http://en.wikipedia.org/wiki/Decimal_degrees" target="_blank">http://en.wikipedia.org/wiki/Decimal_degrees</a>
Not using <code>meters.per.degree.lon</code> the results would be roughly ( 1 / ((pi/180) * 6378.137 * cos(lat * 0.01745329)) )
where 0.01745329 is pi/180 to convert to radians. see <a href="http://en.wikipedia.org/wiki/Decimal_degrees" target="_blank">http://en.wikipedia.org/wiki/Decimal_degrees</a>
The equator is divided into 360 degrees of longitude, so 
each degree at the equator represents 111,319.9 metres or approximately 111.32 km.
As one gets further from the equator, one degree of longitude 
must be multiplied by the cosine of the latitude, decreasing distance per degree lon, approaching zero at the pole.
For most northern point of USA <code>http://en.wikipedia.org/wiki/Extreme_points_of_the_United_States</code>, where 
one finds maximum degrees lon per mile, latitude is just under 72, and cos of 72 degrees= cos(72 * pi/180) = 0.309 , 
so miles/degrees is about 111.32 km * 0.309 = 34.4 km = 21.4 miles roughly.
</p>


<h3>Value</h3>

<p>Returns decimal degrees longitude per km traveled E-W, as a number or vector of numbers the same length as the input lat.
</p>


<h3>See Also</h3>

<p><code><a href="#meters.per.degree.lon">meters.per.degree.lon</a></code> for the inverse of this function (other than a factor of 1000),
and <code><a href="#get.distances">get.distances</a></code> which allows you to specify a search radius and 
get distances only within that radius, and related functions.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">deltalon.per.km<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 
  <span class="token comment"># Roughly 111 km/degree moved East-West at the equator roughly, or around 21 miles.</span>
deltalon.per.km<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">72</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="gcd">

<a href="#gcd" class="help-page-title"><h2>Distance between two points by Haversine, Spherical Law of Cosines, or Vincenty inverse formula</h2></a>

<h3>Description</h3>

<p>Calculates the geodesic distance between two points (or multiple pairs of points) specified by degrees (DD) latitude/longitude using
Haversine formula (hf), Spherical Law of Cosines (slc) and Vincenty inverse formula for ellipsoids (vif) <br>
Taken from <a href="http://www.r-bloggers.com/great-circle-distance-calculations-in-r/" target="_blank">http://www.r-bloggers.com/great-circle-distance-calculations-in-r/</a> <br>
Note these are not the most accurate method for long distances (e.g., &gt;1000 km) nor the fastest.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">gcd<span class="token punctuation">(</span>frompoints<span class="token punctuation">,</span> topoints<span class="token punctuation">,</span> dfunc <span class="token operator">=</span> <span class="token string">"hf"</span><span class="token punctuation">,</span> units <span class="token operator">=</span> <span class="token string">"km"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>frompoints</code></td>
<td>
<p>Required matrix or data.frame of 2 columns, named lat and lon, with latitude and longitude(s) in degrees, one row per point.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>topoints</code></td>
<td>
<p>Required matrix or data.frame of 2 columns, named lat and lon, with latitude and longitude(s) in degrees, one row per point.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dfunc</code></td>
<td>
<p>Character string "hf" for Haversine by default, or "slc" for Spherical Law of Cosines 
(and may add "vif" for Vincenty inverse formula but that is not implemented here). 
For "sp" algorithm (<span class="pkg">sp</span>), see <code><a href="#get.distances">get.distances</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>units</code></td>
<td>
<p>Optional character variable specifying 'km' or 'miles', 'km' by default.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>*** frompoints and topoints must have same number of rows, defining all pairs of points.
Alternatively can define a single point while topoints defines a series of points, or vice versa.
Taken from <a href="http://www.r-bloggers.com/great-circle-distance-calculations-in-r/" target="_blank">http://www.r-bloggers.com/great-circle-distance-calculations-in-r/</a>
but use <code><a href="https://r-universe.dev/manuals/base.html#Extremes">pmin</a></code> instead of <code><a href="https://r-universe.dev/manuals/base.html#Extremes">min</a></code> to vectorize it to handle at least pairs,
and parameters changed to keep lat/lon as a matrix or data.frame rather than 2 separate vectors.
</p>


<h3>Value</h3>

<p>Distance in kilometers by default, or in miles if units='miles'
</p>


<h3>See Also</h3>

<p><code><a href="#convert">convert</a></code>, <code><a href="#gcd">gcd</a></code>, <code><a href="#get.distances">get.distances</a></code>, <code><a href="#get.distances.all">get.distances.all</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="gcd.hf">

<a href="#gcd.hf" class="help-page-title"><h2>Distance based on Haversine formula</h2></a>

<h3>Description</h3>

<p>Calculates the geodesic distance between two points,
or multiple pairs of points, specified by radian latitude/longitude.
</p>
<p>Calculates the geodesic distance between two points 
(or multiple pairs of points) specified by radian latitude/longitude.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">gcd.hf<span class="token punctuation">(</span>long1<span class="token punctuation">,</span> lat1<span class="token punctuation">,</span> long2<span class="token punctuation">,</span> lat2<span class="token punctuation">)</span>

gcd.hf<span class="token punctuation">(</span>long1<span class="token punctuation">,</span> lat1<span class="token punctuation">,</span> long2<span class="token punctuation">,</span> lat2<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>long1</code></td>
<td>
<p>longitude(s) in radians, vector of one or more numbers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat1</code></td>
<td>
<p>latitude(s) in radians, vector of one or more numbers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>long2</code></td>
<td>
<p>longitude(s) in radians, vector of one or more numbers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat2</code></td>
<td>
<p>latitude(s) in radians, vector of one or more numbers</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>long1 and lat1 must be same length. long2 and lat1 must be same length.
All four must be the same length, defining pairs of points. 
Alternatively long1 and lat1 can define a single point while long2 and lat2 define a series of points, or vice versa.
Taken from <a href="http://www.r-bloggers.com/great-circle-distance-calculations-in-r/" target="_blank">http://www.r-bloggers.com/great-circle-distance-calculations-in-r/</a>
but use <code><a href="https://r-universe.dev/manuals/base.html#Extremes">pmin</a></code> instead of <code><a href="https://r-universe.dev/manuals/base.html#Extremes">min</a></code> to vectorize it to handle at least pairs.
</p>
<p>long1 and lat1 must be same length. long2 and lat1 must be same length.
All four must be the same length, defining pairs of points. 
Alternatively long1 and lat1 can define a single point while long2 and lat2 define a series of points, or vice versa.
Taken from <a href="http://www.r-bloggers.com/great-circle-distance-calculations-in-r/" target="_blank">http://www.r-bloggers.com/great-circle-distance-calculations-in-r/</a>
but use <code><a href="https://r-universe.dev/manuals/base.html#Extremes">pmin</a></code> instead of <code><a href="https://r-universe.dev/manuals/base.html#Extremes">min</a></code> to vectorize it to handle at least pairs.
</p>


<h3>Value</h3>

<p>Distance in kilometers
</p>
<p>Distance in kilometers
</p>


<h3>See Also</h3>

<p><code><a href="#convert">convert</a></code>, <code><a href="#gcd">gcd</a></code>, <code><a href="#get.distances">get.distances</a></code>, <code><a href="#get.distances.all">get.distances.all</a></code>
</p>
<p><code><a href="#convert">convert</a></code>, <code><a href="#gcd">gcd</a></code>, <code><a href="#get.distances">get.distances</a></code>, <code><a href="#get.distances.all">get.distances.all</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="gcd.slc">

<a href="#gcd.slc" class="help-page-title"><h2>Distance based on spherical law of cosines</h2></a>

<h3>Description</h3>

<p>Calculates the geodesic distance between two points 
(or multiple pairs of points) specified by radian latitude/longitude.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">gcd.slc<span class="token punctuation">(</span>long1<span class="token punctuation">,</span> lat1<span class="token punctuation">,</span> long2<span class="token punctuation">,</span> lat2<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>long1</code></td>
<td>
<p>longitude(s) in radians, vector of one or more numbers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat1</code></td>
<td>
<p>latitude(s) in radians, vector of one or more numbers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>long2</code></td>
<td>
<p>longitude(s) in radians, vector of one or more numbers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat2</code></td>
<td>
<p>latitude(s) in radians, vector of one or more numbers</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>long1 and lat1 must be same length. long2 and lat1 must be same length.
All four must be the same length, defining pairs of points. 
Alternatively long1 and lat1 can define a single point while long2 and lat2 define a series of points, or vice versa.
Taken from <a href="http://www.r-bloggers.com/great-circle-distance-calculations-in-r/" target="_blank">http://www.r-bloggers.com/great-circle-distance-calculations-in-r/</a>
but use <code><a href="https://r-universe.dev/manuals/base.html#Extremes">pmin</a></code> instead of <code><a href="https://r-universe.dev/manuals/base.html#Extremes">min</a></code> to vectorize it to handle at least pairs.
</p>


<h3>Value</h3>

<p>Distance in kilometers
</p>


<h3>See Also</h3>

<p><code><a href="#convert">convert</a></code>, <code><a href="#gcd">gcd</a></code>, <code><a href="#get.distances">get.distances</a></code>, <code><a href="#get.distances.all">get.distances.all</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="get.bg.latlons">

<a href="#get.bg.latlons" class="help-page-title"><h2>Was used to get block group internal points directly from Census shapefiles</h2></a>

<h3>Description</h3>

<p>Download, unzip, read, and assemble lat lon of internal points for US Census block groups.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.bg.latlons<span class="token punctuation">(</span>
  myyear <span class="token operator">=</span> <span class="token number">2014</span><span class="token punctuation">,</span>
  mytempdir<span class="token punctuation">,</span>
  mystatenums<span class="token punctuation">,</span>
  overwrite <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  silent <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>myyear</code></td>
<td>
<p>Year such as 2014 (default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mytempdir</code></td>
<td>
<p>Optional. Default is TIGERTEMP created inside the current working directory. Character string of path to where temporary directory is or will be, for downloaded zip and dbf files.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mystatenums</code></td>
<td>
<p>Optional, default is all including PR/VI/DC, etc. Vector of strings of 2-character FIPS codes for states to get data for.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p>Optional, FALSE by default (unlike in unzip), which means
if zip file exists locally do not download and if contents exist do not unzip.
BUT note this does not yet check to see if contents exist and zip does not, in which case could avoid downloading.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silent</code></td>
<td>
<p>Optional logical FALSE by default. If TRUE, print more results.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Note this is obsolete if used to create data() containing the results:
bg.pts = get.bg.latlons(mytempdir = getwd(), overwrite=FALSE, silent = TRUE)
save(bg.pts, file='bg.pts') # and then this can be saved in the data folder of a package, then build pkg, then access via data('bg.pts')
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#get.bg.latlons(mystatenums=c('09','10'))</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.distances">

<a href="#get.distances" class="help-page-title"><h2>Find distances between nearby points, within specified radius.</h2></a>

<h3>Description</h3>

<p>WORK IN PROGRESS. Returns the distances from one set of points to nearby members of another set of points.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.distances<span class="token punctuation">(</span>
  frompoints<span class="token punctuation">,</span>
  topoints<span class="token punctuation">,</span>
  radius <span class="token operator">=</span> <span class="token number">5200</span><span class="token punctuation">,</span>
  units <span class="token operator">=</span> <span class="token string">"miles"</span><span class="token punctuation">,</span>
  ignore0 <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  dfunc <span class="token operator">=</span> <span class="token string">"sp"</span><span class="token punctuation">,</span>
  as.df <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  return.rownums <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  return.latlons <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  return.crosstab <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  tailored.deltalon <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>frompoints</code></td>
<td>
<p>A matrix or data.frame with two cols, 'lat' and 'lon' with datum=WGS84 assumed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>topoints</code></td>
<td>
<p>A matrix or data.frame with two cols, 'lat' and 'lon' with datum=WGS84 assumed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>A single number defining nearby, the maximum distance searched for or recorded. 
Default is max allowed... radius must be less than about 8,368 kilometers (5,200 miles, or the distance from Hawaii to Maine)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>units</code></td>
<td>
<p>A string that is 'miles' by default, or 'km' for kilometers, specifying units for radius and distances returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore0</code></td>
<td>
<p>A logical, default is FALSE, specifying whether to ignore distances that are zero and report only nonzero distances.
Useful if want distance to points other than self, where frompoints=topoints, for example. Ignored if return.crosstab = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dfunc</code></td>
<td>
<p>Optional character element "hf" or "slc" to specify distance function Haversine or spherical law of cosines.
If "sp" (default), it uses the <span class="pkg">sp</span> package to find distances more accurately and more quickly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as.df</code></td>
<td>
<p>Optional logical, default is TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.rownums</code></td>
<td>
<p>Logical value, TRUE by default. If TRUE, value returned also includes two extra columns:
a col of index numbers starting at 1 specifying the frompoint and a similar col specifying the topoint.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.latlons</code></td>
<td>
<p>Logical value, FALSE by default. If TRUE, value returned also includes four extra columns,
showing fromlat, fromlon, tolat, tolon.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.crosstab</code></td>
<td>
<p>Logical value, FALSE by default. If TRUE, value returned is a matrix of the distances, 
with a row per frompoint and col per topoint. (Distances larger than max search radius are not provided, even in this format).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tailored.deltalon</code></td>
<td>
<p>Logical value, FALSE by default, but ignored. Leftover from older get.distances function. Defined size of initially searched area as function of lat, for each frompoint,
rather than initially searching a conservatively large box.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function returns a matrix or vector of distances, 
which are the distances from one set of points to the nearby members of another set of points.
It searches within a circle (of radius = radius, defining what is considered nearby), 
to calculate distance (in miles or km) from each of frompoints to each of topoints that is within the specified radius.
Points are specified using latitude and longitude in decimal degrees.  <br><br>
Uses <code><a href="#get.distances.all">get.distances.all</a></code>. 
Relies on the <span class="pkg">sp</span> package for the <code><a href="https://edzer.r-universe.dev/sp/doc/manual.html#spDistsN1">spDistsN1</a></code> and <code><a href="https://edzer.r-universe.dev/sp/doc/manual.html#SpatialPoints">SpatialPoints</a></code> functions.   <br><br>
Regarding distance calculation, also see <a href="http://en.wikipedia.org/wiki/Vincenty%27s_formulae" target="_blank">http://en.wikipedia.org/wiki/Vincenty%27s_formulae</a>, 
<a href="http://williams.best.vwh.net/avform.htm#Dist" target="_blank">http://williams.best.vwh.net/avform.htm#Dist</a>, <a href="http://sourceforge.net/projects/geographiclib/" target="_blank">http://sourceforge.net/projects/geographiclib/</a>, 
and <a href="http://www.r-bloggers.com/great-circle-distance-calculations-in-r/" target="_blank">http://www.r-bloggers.com/great-circle-distance-calculations-in-r/</a>.  <br><br>
Finding distance to all of the 11 million census blocks in usa within 5 km, for 100 points, can take a while.
May want to look at js library like turf, 
or investigate using data.table to index and more quickly subset the (potentially 11 million Census blocks of) topoints
(or pre-index that block point dataset and allow this function to accept a data.table as input).
</p>


<h3>Value</h3>

<p>By default, returns a dataframe that has 3 columns: fromrow, torow, distance 
(where fromrow or torow is the row number of the corresponding input, starting at 1).
Distance returned is in miles by default, but with option to set units='km' to get kilometers.
See parameters for details on other formats that may be returned if specified.
</p>


<h3>See Also</h3>

<p><code><a href="#get.distances.all">get.distances.all</a></code> which allows you to get distances between all points,
<code><a href="#get.distances.prepaired">get.distances.prepaired</a></code> for finding distances when data are already formatted as pairs of points,
<code><a href="#get.nearest">get.nearest</a></code> which finds the distance to the single nearest point 
within a specified search radius instead of all topoints, and 
<code><a href="#proxistat">proxistat</a></code> which calculates a proximity score for each spatial unit based on distances to nearby points.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#</span>
set.seed<span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span>
t1<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
t10<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
t100<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span>  minlat <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">,</span> maxlat <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">,</span> minlon <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> maxlon <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">)</span>
t1k<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e3</span><span class="token punctuation">,</span>   minlat <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">,</span> maxlat <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">,</span> minlon <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> maxlon <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">)</span>
t10k<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e4</span><span class="token punctuation">)</span>
t100k<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e5</span><span class="token punctuation">)</span>
t1m<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e6</span><span class="token punctuation">)</span>
<span class="token comment">#t10m=testpoints(1e7)</span>
   test.from <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>fromlat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9567309094</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
     fromlon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0896572305</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> <span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
     row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">)</span>
    
   test.to <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>tolat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9575019287</span><span class="token punctuation">,</span> <span class="token number">38.9507043428</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    tolon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0892818598</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> <span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">,</span> 
    row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
   <span class="token comment">#*** Can fail if radius=50 miles? ... Error in rbind() numbers of</span>
   <span class="token comment">#  columns of arguments do not match !</span>
   <span class="token comment">#big = get.distances(t100, t1k, radius=100, units='miles', return.latlons=TRUE, as.df=TRUE) </span>
     head<span class="token punctuation">(</span>big<span class="token punctuation">)</span>
     <span class="token comment">#summary(big$d)</span>
   big <span class="token operator">=</span> get.distances<span class="token punctuation">(</span>t100<span class="token punctuation">,</span> t1k<span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'miles'</span><span class="token punctuation">,</span> return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> as.df<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> 
     head<span class="token punctuation">(</span>big<span class="token punctuation">)</span>
     summary<span class="token punctuation">(</span>big<span class="token operator">$</span>d<span class="token punctuation">)</span>
   
   <span class="token comment"># see as map of many points</span>
    plot<span class="token punctuation">(</span>big<span class="token operator">$</span>fromlon<span class="token punctuation">,</span> big<span class="token operator">$</span>fromlat<span class="token punctuation">,</span>main<span class="token operator">=</span>'from black circles<span class="token ellipsis">...</span> 
      closest is red<span class="token punctuation">,</span> others nearby are green '<span class="token punctuation">)</span>
    points<span class="token punctuation">(</span>t1k<span class="token operator">$</span>lon<span class="token punctuation">,</span> t1k<span class="token operator">$</span>lat<span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span>pch<span class="token operator">=</span><span class="token string">'.'</span><span class="token punctuation">)</span>
    points<span class="token punctuation">(</span>big<span class="token operator">$</span>tolon<span class="token punctuation">,</span> big<span class="token operator">$</span>tolat<span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>
   junk<span class="token operator">=</span>as.data.frame<span class="token punctuation">(</span> get.nearest<span class="token punctuation">(</span>t100<span class="token punctuation">,</span> t1k<span class="token punctuation">,</span> return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
   points<span class="token punctuation">(</span>junk<span class="token operator">$</span>tolon<span class="token punctuation">,</span> junk<span class="token operator">$</span>tolat<span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
   <span class="token comment"># Draw lines from frompoint to nearest:</span>
   with<span class="token punctuation">(</span>junk<span class="token punctuation">,</span>linesegments<span class="token punctuation">(</span>fromlon<span class="token punctuation">,</span> fromlat<span class="token punctuation">,</span> tolon<span class="token punctuation">,</span> tolat<span class="token punctuation">)</span> <span class="token punctuation">)</span>
   
    <span class="token comment"># more test cases</span>
 length<span class="token punctuation">(</span>get.distances<span class="token punctuation">(</span>t10<span class="token punctuation">,</span>t10<span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">4999</span><span class="token punctuation">,</span>ignore0 <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span><span class="token operator">$</span>d<span class="token punctuation">)</span>
 get.distances<span class="token punctuation">(</span>t10<span class="token punctuation">,</span>t10<span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">4999</span><span class="token punctuation">,</span>ignore0 <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span>F<span class="token punctuation">,</span>return.latlons<span class="token operator">=</span>F<span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
 
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span>F<span class="token punctuation">,</span>return.latlons<span class="token operator">=</span>F<span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
 
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span>F<span class="token punctuation">,</span>return.latlons<span class="token operator">=</span>F<span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
 
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span>F<span class="token punctuation">,</span>return.latlons<span class="token operator">=</span>F<span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span>T<span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span>F<span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'miles'</span><span class="token punctuation">)</span>

  <span class="token comment"># Warning messages:</span>
  <span class="token comment"># Ignoring return.crosstab because radius was specified</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> return.crosstab<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> return.crosstab<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> return.crosstab<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">,</span> return.crosstab<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.distances.all">

<a href="#get.distances.all" class="help-page-title"><h2>Find all distances between two sets of points (based on lat/lon)</h2></a>

<h3>Description</h3>

<p>Returns all the distances from one set of geographic points to another set of points.
Can return a matrix of distances (m x n points) or vector or data.frame with one row per pair.
Lets you specify units and whether you need lat/lon etc, but essentially just a wrapper for
the <span class="pkg">sp</span> package for the <code><a href="https://edzer.r-universe.dev/sp/doc/manual.html#spDistsN1">spDistsN1</a></code> and <code><a href="https://edzer.r-universe.dev/sp/doc/manual.html#SpatialPoints">SpatialPoints</a></code> functions.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.distances.all<span class="token punctuation">(</span>
  frompoints<span class="token punctuation">,</span>
  topoints<span class="token punctuation">,</span>
  units <span class="token operator">=</span> <span class="token string">"miles"</span><span class="token punctuation">,</span>
  return.crosstab <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  return.rownums <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  return.latlons <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  as.df <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>frompoints</code></td>
<td>
<p>A matrix or data.frame with two cols, 'lat' and 'lon' with datum=WGS84 assumed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>topoints</code></td>
<td>
<p>A matrix or data.frame with two cols, 'lat' and 'lon' with datum=WGS84 assumed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>units</code></td>
<td>
<p>A string that is 'miles' by default, or 'km' for kilometers,
specifying units for distances returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.crosstab</code></td>
<td>
<p>Logical value, FALSE by default. If TRUE, value returned is a matrix of the distances,
with a row per frompoint and col per topoint.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.rownums</code></td>
<td>
<p>Logical value, TRUE by default. If TRUE, value returned also includes two extra columns:
a col of index numbers starting at 1 specifying the frompoint and a similar col specifying the topoint.
If crosstab=TRUE, ignores return.rownums and return.latlons</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.latlons</code></td>
<td>
<p>Logical value, TRUE by default. If TRUE, value returned also includes four extra columns,
showing fromlat, fromlon, tolat, tolon.
If crosstab=TRUE, ignores return.rownums and return.latlons</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as.df</code></td>
<td>
<p>Logical, default is TRUE, in which case returns a data.frame (unless vector), otherwise a matrix (unless vector).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>*** Probably slower than it needs to be partly by using data.frame instead of matrix class? Roughly 10-20
Just using get.distances.all is reasonably fast? (30-40 seconds for 100 million distances, but slow working with results so large),
Sys.time(); x=get.distances.all(testpoints(1e5), testpoints(1000), return.crosstab=TRUE); Sys.time() <br>
[1] "2015-03-10 18:59:08 EDT" <br>
[1] "2015-03-10 18:59:31 EDT"  23 SECONDS  for 100 million distances IF NO PROCESSING OTHER THAN CROSSTAB <br>
Sys.time(); x=get.distances.all(testpoints(1e6), testpoints(100), return.crosstab=TRUE); Sys.time() <br>
[1] "2015-03-10 21:54:11 EDT" <br>
[1] "2015-03-10 21:54:34 EDT"  23 SECONDS for 100 million distances (1m x 100, or 100k x 1000) <br>
Sys.time(); x=get.distances.all(testpoints(1e6), testpoints(300), return.crosstab=TRUE); Sys.time() <br>
[1] "2015-03-10 21:56:11 EDT" <br>
[1] "2015-03-10 21:57:18 EDT"  67 seconds for 300 million pairs.  <br>
plus 20 seconds or so for x[x&gt;100] &lt;- Inf  <br>
#' so 11m blocks to 1k points could take &gt;40 minutes! (you would want to more quickly remove the ones outside some radius)  <br>
&gt;3 minutes per 100 sites? <br>
About 2.6 seconds per site for 11m blocks?  <br><br>
&gt; Sys.time(); x=get.distances.all(testpoints(1e5), testpoints(1000), units='miles',return.rownums=TRUE); Sys.time() <br>
[1] "2015-03-09 21:23:04 EDT" <br>
[1] "2015-03-09 21:23:40 EDT"  36 SECONDS IF DATA.FRAME ETC. DONE TO FORMAT RESULTS AND GET ROWNUMS <br>
&gt; Sys.time(); x=get.distances.all(testpoints(1e5), testpoints(1000), units='miles',return.rownums=TRUE)$d; Sys.time() <br>
[1] "2015-03-09 21:18:47 EDT" <br>
[1] "2015-03-09 21:19:26 EDT" 49 SECONDS IF DATA.FRAME ETC. DONE TO FORMAT RESULTS AND GET ROWNUMS IN get.distances.all <br></p>


<h3>Value</h3>

<p>By default, returns a dataframe that has 3 columns: fromrow, torow, distance
(where fromrow or torow is the row number of the corresponding input, starting at 1).
If return.crosstab=FALSE, which is default, and return.rownums and/or return.latlons is TRUE,
returns a row per from-to pair, and columns depending on parameters, sorted first cycling through all topoints for first frompoint, and so on.
If return.crosstab=FALSE and return.rownums and return.latlons are FALSE, returns a vector of distances in same order as rows described above.
If return.crosstab=TRUE, returns a matrix of distances, with one row per frompoint and one column per topoint.
</p>


<h3>See Also</h3>

<p><code><a href="#get.distances">get.distances</a></code> which allows you to specify a search radius and
get distances only within that radius which can be faster,
<code><a href="#get.distances.prepaired">get.distances.prepaired</a></code> for finding distances when data are already formatted as pairs of points,
<code><a href="#get.nearest">get.nearest</a></code> which finds the distance to the single nearest point
within a specified search radius instead of all topoints, and
<code><a href="#proxistat">proxistat</a></code> which calculates a proximity score for each spatial unit
based on distances to nearby points.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">set.seed<span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span>
t1<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
t10<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
t100<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> minlat<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">,</span>maxlat<span class="token operator">=</span><span class="token number">48</span><span class="token punctuation">)</span>
t1k<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e3</span><span class="token punctuation">)</span>
t10k<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e4</span><span class="token punctuation">)</span>
t100k<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e5</span><span class="token punctuation">)</span>
t1m<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e6</span><span class="token punctuation">)</span>
<span class="token comment">#t10m=testpoints(1e7)</span>

get.distances.all<span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t1<span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t10<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">,</span>drop<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
x<span class="token operator">=</span>get.distances.all<span class="token punctuation">(</span>t10<span class="token punctuation">,</span> t100<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">20</span> <span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>
 plot<span class="token punctuation">(</span>x<span class="token operator">$</span>tolon<span class="token punctuation">,</span> x<span class="token operator">$</span>tolat<span class="token punctuation">,</span>pch<span class="token operator">=</span><span class="token string">'.'</span><span class="token punctuation">)</span>
 points<span class="token punctuation">(</span>x<span class="token operator">$</span>fromlon<span class="token punctuation">,</span> x<span class="token operator">$</span>fromlat<span class="token punctuation">)</span>
 with<span class="token punctuation">(</span>x<span class="token punctuation">,</span> linesegments<span class="token punctuation">(</span>fromlon<span class="token punctuation">,</span> fromlat<span class="token punctuation">,</span> tolon<span class="token punctuation">,</span> tolat <span class="token punctuation">)</span><span class="token punctuation">)</span>
 with<span class="token punctuation">(</span>x<span class="token punctuation">[</span>x<span class="token operator">$</span>d<span class="token operator">&lt;</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> linesegments<span class="token punctuation">(</span>fromlon<span class="token punctuation">,</span> fromlat<span class="token punctuation">,</span> tolon<span class="token punctuation">,</span> tolat <span class="token punctuation">,</span>col<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
x<span class="token operator">=</span>get.distances.all<span class="token punctuation">(</span>t10<span class="token punctuation">,</span> t1k<span class="token punctuation">)</span><span class="token punctuation">;</span> head<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>summary<span class="token punctuation">(</span>x<span class="token operator">$</span>d<span class="token punctuation">)</span>
x<span class="token operator">=</span>get.distances.all<span class="token punctuation">(</span>t10<span class="token punctuation">,</span> t1k<span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> head<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>summary<span class="token punctuation">(</span>x<span class="token operator">$</span>d<span class="token punctuation">)</span>
x<span class="token operator">=</span>get.distances.all<span class="token punctuation">(</span>t10<span class="token punctuation">,</span> t1k<span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> head<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>summary<span class="token punctuation">(</span>x<span class="token operator">$</span>d<span class="token punctuation">)</span>

<span class="token comment">## Not run: </span>
require<span class="token punctuation">(</span>UScensus2010blocks<span class="token punctuation">)</span> <span class="token comment"># for the get.blocks() function and dataset</span>
blocks <span class="token operator">&lt;-</span> get.blocks<span class="token punctuation">(</span>fields<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token string">'fips'</span><span class="token punctuation">,</span><span class="token string">'lat'</span><span class="token punctuation">,</span><span class="token string">'lon'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>charfips <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span>

   test.from <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>fromlat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9567309094</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     fromlon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0896572305</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> <span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">)</span>

   test.to <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>tolat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9575019287</span><span class="token punctuation">,</span> <span class="token number">38.9507043428</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    tolon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0892818598</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> <span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">,</span>
    row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 test.to.<span class="token keyword">NA</span> <span class="token operator">=</span> rbind<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">,</span> test.to<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 test.from.<span class="token keyword">NA</span> <span class="token operator">=</span> rbind<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">,</span> test.to<span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">,</span> test.to<span class="token punctuation">,</span> return.crosstab<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">,</span> test.to<span class="token punctuation">,</span> return.rownums<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">,</span> test.to<span class="token punctuation">,</span> return.latlons<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">,</span> test.to<span class="token punctuation">,</span> return.latlons<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span> return.rownums<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>

     <span class="token comment"># test cases</span>

get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">,</span>    test.to.<span class="token keyword">NA</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from.<span class="token keyword">NA</span><span class="token punctuation">,</span> test.to<span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from.<span class="token keyword">NA</span><span class="token punctuation">,</span> test.to.<span class="token keyword">NA</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span>F<span class="token punctuation">,</span>return.latlons<span class="token operator">=</span>F<span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>

get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span>F<span class="token punctuation">,</span>return.latlons<span class="token operator">=</span>F<span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>

get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span>F<span class="token punctuation">,</span>return.latlons<span class="token operator">=</span>F<span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>

round<span class="token punctuation">(</span>get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span>F<span class="token punctuation">,</span>return.latlons<span class="token operator">=</span>F<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span>T<span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span>F<span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'miles'</span><span class="token punctuation">)</span>

get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> return.crosstab<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> return.crosstab<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
round<span class="token punctuation">(</span>get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>return.crosstab<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'miles'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
round<span class="token punctuation">(</span>get.distances.all<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.to<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>return.crosstab<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.distances.chunked">

<a href="#get.distances.chunked" class="help-page-title"><h2>Call a function once per chunk &amp; save output as file (breaks large input data into chunks)</h2></a>

<h3>Description</h3>

<p>Call get.distances function in chunks, when list of frompoints is so long it taxes RAM (e.g. 11m blocks),
saving each chunk as a separate .RData file in current working directory
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.distances.chunked<span class="token punctuation">(</span>
  frompoints<span class="token punctuation">,</span>
  topoints<span class="token punctuation">,</span>
  fromchunksize<span class="token punctuation">,</span>
  tochunksize<span class="token punctuation">,</span>
  FUN <span class="token operator">=</span> get.distances<span class="token punctuation">,</span>
  folder <span class="token operator">=</span> getwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>frompoints</code></td>
<td>
<p>Require matrix or data.frame of lat/lon vauels that can be passed to get.distances function (colnames 'lat' and 'lon')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>topoints</code></td>
<td>
<p>Require matrix or data.frame of lat/lon vauels that can be passed to get.distances function (colnames 'lat' and 'lon')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fromchunksize</code></td>
<td>
<p>Required, number specifying how many points to analyze at a time (per chunk).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tochunksize</code></td>
<td>
<p>(not yet implemented - current default is to use all topoints at once) number specifying how many points to analyze at a time (per chunk).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FUN</code></td>
<td>
<p>Optional function, <code><a href="#get.distances">get.distances</a></code> by default, no other value allowed currently.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>folder</code></td>
<td>
<p>Optional path specifying where to save .RData files, default is getwd()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other parameters to pass to <code><a href="#get.distances">get.distances</a></code>, such as <code>radius</code> or <code>units</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>filesizes if crosstab format (FASTEST &amp; avoid needing rownums which take &gt;twice as long &amp; 1.25x sized file): <br>
80MB file/chunk if   1k blocks x 11k topoints/chunk:  <br>
y=get.distances.chunked(testpoints(11e6), testpoints(11000), 1e3, units='km',return.crosstab=TRUE)<br>
800MB file/chunk if 10k blocks x 11k topoints/chunk:  <br>
y=get.distances.chunked(testpoints(11e6), testpoints(11000), 1e4, units='km',return.crosstab=TRUE)<br></p>


<h3>Value</h3>

<p>Returns vector of character elements that are filenames for saved .RData output files in current working directory or specified folder.
</p>


<h3>See Also</h3>

<p><span class="pkg">ff</span> and others related to parallelization, etc.
</p>

<hr>
</div>
<div class="container manual-page" id="get.distances.prepaired">

<a href="#get.distances.prepaired" class="help-page-title"><h2>Find distances between points, for pairs of points already organized as pairs.</h2></a>

<h3>Description</h3>

<p><code>get.distances.prepaired</code> returns all the distances between each specified pair of points.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.distances.prepaired<span class="token punctuation">(</span>pts<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>pts</code></td>
<td>
<p>A matrix or data.frame that has columns names 'fromlon', 'fromlat', 'tolon', 'tolat' with datum=WGS84 assumed.</p>
</td>
</tr></table>
<h3>Details</h3>

<p>May need to fix cases where only a single row is input.
This function returns a matrix or vector of distances, 
between points specified as pairs of lat/lon values.
Points are specified using latitude and longitude in decimal degrees.
Relies on the <span class="pkg">sp</span> package for the <code><a href="https://edzer.r-universe.dev/sp/doc/manual.html#spDistsN1">spDistsN1</a></code> and <code><a href="https://edzer.r-universe.dev/sp/doc/manual.html#SpatialPoints">SpatialPoints</a></code> functions.
</p>


<h3>Value</h3>

<p>Returns a vector of distances as numbers, in kilometers. Each element corresponds to one row in pts.
</p>


<h3>See Also</h3>

<p><code><a href="#get.distances.all">get.distances.all</a></code> for a useful general function, <code><a href="#get.distances">get.distances</a></code> for get.distances() which allows you to specify a search radius and 
get distances only within that radius which can be faster,
<code><a href="#get.nearest">get.nearest</a></code> which finds the distance to the single nearest point 
within a specified search radius instead of all topoints, and 
<code><a href="#proxistat">proxistat</a></code> which calculates a proximity score for each spatial unit
based on distances to nearby points.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">test.from <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>fromlat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9567309094</span><span class="token punctuation">,</span> <span class="token number">38.9507043428</span><span class="token punctuation">,</span> <span class="token number">38.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 fromlon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0896572305</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0896199948</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> <span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token string">"two"</span><span class="token punctuation">,</span> <span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">)</span>
test.to <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>tolat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9575019287</span><span class="token punctuation">,</span> <span class="token number">38.9507043428</span><span class="token punctuation">,</span> <span class="token number">38.9514152435</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 tolon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0892818598</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0896199948</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0972395245</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> <span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
get.distances.prepaired<span class="token punctuation">(</span>data.frame<span class="token punctuation">(</span>
  fromlat<span class="token operator">=</span>test.from<span class="token operator">$</span>lat<span class="token punctuation">,</span> fromlon<span class="token operator">=</span>test.from<span class="token operator">$</span>lon<span class="token punctuation">,</span> tolat<span class="token operator">=</span>test.to<span class="token operator">$</span>lat<span class="token punctuation">,</span> tolon<span class="token operator">=</span>test.to<span class="token operator">$</span>lon<span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.nearest">

<a href="#get.nearest" class="help-page-title"><h2>Find distance from each point in a set to the nearest of a second set of points (by lat/lon).</h2></a>

<h3>Description</h3>

<p><code>get.nearest</code> returns the distance from each point in a set to the nearest of a second set of points (by lat/lon).
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.nearest<span class="token punctuation">(</span>
  frompoints<span class="token punctuation">,</span>
  topoints<span class="token punctuation">,</span>
  units <span class="token operator">=</span> <span class="token string">"miles"</span><span class="token punctuation">,</span>
  ignore0 <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  return.rownums <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  return.latlons <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  radius <span class="token operator">=</span> <span class="token number">Inf</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>frompoints</code></td>
<td>
<p>A matrix or data.frame with two cols, 'lat' and 'lon' (or only 2 cols that are lat and lon in that order) with datum=WGS84 assumed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>topoints</code></td>
<td>
<p>A matrix or data.frame with two cols, 'lat' and 'lon' (or only 2 cols that are lat and lon in that order) with datum=WGS84 assumed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>units</code></td>
<td>
<p>A string that is 'miles' by default, or 'km' for kilometers, specifying units for distances returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore0</code></td>
<td>
<p>A logical, default is FALSE, specifying whether to ignore distances that are zero and report only the minimum nonzero distance. 
Useful if nearest point other than self, where frompoints=topoints, for example.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.rownums</code></td>
<td>
<p>Logical value, TRUE by default. If TRUE, value returned also includes these 2 columns:
a col named fromrow of index numbers starting at 1 specifying the frompoint and a similar col named n specifying the row of the nearest topoint.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.latlons</code></td>
<td>
<p>Logical value, FALSE by default. If TRUE, value returned also includes four extra columns,
showing fromlat, fromlon, tolat, tolon.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>Optional number, default is Inf. Distance within which search should be limited, or max distance that will be returned.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function returns a vector of distances, 
which are the distances from one set of points to the nearest single member (if any) of another set of points.
Points are specified using latitude and longitude in decimal degrees.
Relies on the <span class="pkg">sp</span> package for the <code><a href="https://edzer.r-universe.dev/sp/doc/manual.html#spDistsN1">spDistsN1</a></code> and <code><a href="https://edzer.r-universe.dev/sp/doc/manual.html#SpatialPoints">SpatialPoints</a></code> functions. <br><br></p>
<p>A future version may use get.distances.all() but for performance only use it for distance pairs (pairs of points) that have been initially 
quickly filtered using lat/lon to be not too far, in an attempt to go much faster in an initial pass.
*** old get.nearest with loops takes 42 seconds vs 3 seconds for this version, for 100k frompoints and 100 topoints:  Sys.time(); x=get.nearest(t100k, t100); Sys.time()
&gt; Sys.time(); x=get.nearest(testpoints(1e6), testpoints(100)); Sys.time() <br>
[1] 14:33:05 EDT <br>
[1] 14:33:33 EDT  &lt;30 seconds from 1 mill to 100 points, as in finding nearest of 100 sites for 9
But R hung/crashed on 11mill frompoints  Probably out of memory. *** Need to break it up into batches of maybe 1 to 100 million distances at a time? 
There are 11,078,297 blocks according to <a href="http://www.census.gov/geo/maps-data/data/tallies/national_geo_tallies.html" target="_blank">http://www.census.gov/geo/maps-data/data/tallies/national_geo_tallies.html</a>
</p>


<h3>Value</h3>

<p>By default, returns a vector of distances, but can return a matrix of numbers, with columns that can include fromrow and torow indexing 
which is nearest (first if &gt;1 match) of topoints, fromlat, fromlon, tolat, tolon, and d (distance).
** Returns Inf when no topoints are found within the radius, and also when a distance to nearest is zero but ignore0=TRUE. 
Distance returned is in miles by default, but with option to set units='km' to get kilometers.
See parameters for details on other formats that may be returned if specified.
</p>


<h3>See Also</h3>

<p><code><a href="#get.distances">get.distances</a></code> which gets distances between all points (within an optional search radius),
<code><a href="#get.distances.all">get.distances.all</a></code> which allows you to get distances between all points,
<code><a href="#get.distances.prepaired">get.distances.prepaired</a></code> for finding distances when data are already formatted as pairs of points, and
<code><a href="#proxistat">proxistat</a></code> which calculates a proximity score for each spatial unit based on distances to nearby points.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">set.seed<span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span>
t1<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
t10<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
t100<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
t1k<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e3</span><span class="token punctuation">)</span>
t10k<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e4</span><span class="token punctuation">)</span>
t100k<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e5</span><span class="token punctuation">)</span>
t1m<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e6</span><span class="token punctuation">)</span>
<span class="token comment">#t10m=testpoints(1e7)</span>

get.nearest<span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t1<span class="token punctuation">)</span>
get.nearest<span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t10<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">,</span>drop<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
get.nearest<span class="token punctuation">(</span>t10<span class="token punctuation">,</span> t1k<span class="token punctuation">)</span>
get.nearest<span class="token punctuation">(</span>t10<span class="token punctuation">,</span> t1k<span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>
get.nearest<span class="token punctuation">(</span>t10<span class="token punctuation">,</span> t1k<span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>

test.from <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>fromlat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9567309094</span><span class="token punctuation">,</span> <span class="token number">38.9507043428</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 fromlon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0896572305</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0896199948</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> <span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"6054762"</span><span class="token punctuation">,</span> <span class="token string">"6054764"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">)</span>
test.to <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>tolat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9575019287</span><span class="token punctuation">,</span> <span class="token number">38.9507043428</span><span class="token punctuation">,</span> <span class="token number">38.9514152435</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 tolon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0892818598</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0896199948</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0972395245</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> <span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"6054762"</span><span class="token punctuation">,</span> <span class="token string">"6054763"</span><span class="token punctuation">,</span> <span class="token string">"6054764"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
get.nearest<span class="token punctuation">(</span>test.from<span class="token punctuation">,</span> test.to<span class="token punctuation">)</span>
get.nearest<span class="token punctuation">(</span>testpoints<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> testpoints<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon.colnames.check">

<a href="#latlon.colnames.check" class="help-page-title"><h2>obsolete - see latlon_is.valid()</h2></a>

<h3>Description</h3>

<p>Used by functions like <code><a href="#get.distances">get.distances</a></code> to check input parameters frompoints and topoints
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon.colnames.check<span class="token punctuation">(</span>mypoints<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>mypoints</code></td>
<td>
<p>A matrix or data.frame</p>
</td>
</tr></table>
<h3>Value</h3>

<p>Returns a vector of colnames such as c('lat', 'lon') or stops if problem found
</p>


<h3>See Also</h3>

<p><code><a href="#get.distances.all">get.distances.all</a></code> which allows you to get distances between all points,
<code><a href="#get.distances.prepaired">get.distances.prepaired</a></code> for finding distances when data are already formatted as pairs of points,
<code><a href="#get.nearest">get.nearest</a></code> which finds the distance to the single nearest point 
within a specified search radius instead of all topoints, and 
<code><a href="#proxistat">proxistat</a></code> which calculates a proximity score for each spatial unit based on distances to nearby points.
</p>
<p><code><a href="#get.distances">get.distances</a></code> which allows you to specify a search radius and 
get distances only within that radius which can be faster,
<code><a href="#get.distances.prepaired">get.distances.prepaired</a></code> for finding distances when data are already formatted as pairs of points,
<code><a href="#get.nearest">get.nearest</a></code> which finds the distance to the single nearest point 
within a specified search radius instead of all topoints, and 
<code><a href="#proxistat">proxistat</a></code> which calculates a proximity score for each spatial unit
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_is.valid">

<a href="#latlon_is.valid" class="help-page-title"><h2>Validate latitudes and longitudes</h2></a>

<h3>Description</h3>

<p>Check each latitude and longitude value to see if they are 
NA or outside expected numeric ranges
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_is.valid<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>vector of latitudes in decimal degrees</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>numeric vector of longitudes in decimal degrees, same length</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>logical vector, one element per lat lon pair (location)
</p>


<h3>See Also</h3>

<p>latlon_df_clean() latlon_infer() latlon_is.valid() latlon_as.numeric()
</p>

<hr>
</div>
<div class="container manual-page" id="linesegments">

<a href="#linesegments" class="help-page-title"><h2>Add line segments connecting pairs of points, to a plot</h2></a>

<h3>Description</h3>

<p>Accepts vectors of x and y values of pairs of points (e.g., longitude and latitude), 
reformats them and adds line segments to an existing plot. Each line segment drawn 
connects one point its paired point. The two sets of points have to be equal in length, set up as pairs.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">linesegments<span class="token punctuation">(</span>xfrom<span class="token punctuation">,</span> yfrom<span class="token punctuation">,</span> xto<span class="token punctuation">,</span> yto<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>xfrom</code></td>
<td>
<p>required numeric vector of x values for starting points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yfrom</code></td>
<td>
<p>required numeric vector of y values for starting points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xto</code></td>
<td>
<p>required numeric vector of x values for ending points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yto</code></td>
<td>
<p>required numeric vector of y values for ending points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional additional parameters to pass to <code><a href="https://r-universe.dev/manuals/graphics.html#lines">lines</a></code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function also silently returns a matrix of two columns. 
Each column is a vector that has elements sequenced in groups of three  
the from point, then the to point, then NA to signify a break in line drawing. See <code><a href="https://r-universe.dev/manuals/graphics.html#lines">lines</a></code>
</p>


<h3>Value</h3>

<p>Draws lines(), one line segment from each starting point to its corresponding ending point.
</p>


<h3>See Also</h3>

<p><code><a href="#testpoints">testpoints</a></code> and <code><a href="#get.nearest">get.nearest</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">t10  <span class="token operator">&lt;-</span> testpoints<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>  minlat <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">,</span> maxlat <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">,</span> minlon <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> maxlon <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">)</span>
 t100 <span class="token operator">&lt;-</span> testpoints<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> minlat <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">,</span> maxlat <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">,</span> minlon <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> maxlon <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">)</span>
 nears<span class="token operator">=</span>as.data.frame<span class="token punctuation">(</span> get.nearest<span class="token punctuation">(</span>t10<span class="token punctuation">,</span> t100<span class="token punctuation">,</span> return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
 plot<span class="token punctuation">(</span>t10<span class="token punctuation">)</span>
 plot<span class="token punctuation">(</span>t100<span class="token punctuation">,</span> pch<span class="token operator">=</span><span class="token string">'.'</span><span class="token punctuation">)</span>
 linesegments<span class="token punctuation">(</span>nears<span class="token operator">$</span>fromlon<span class="token punctuation">,</span> nears<span class="token operator">$</span>fromlat<span class="token punctuation">,</span> nears<span class="token operator">$</span>tolon<span class="token punctuation">,</span> nears<span class="token operator">$</span>tolat<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="lookup.states">

<a href="#lookup.states" class="help-page-title"><h2>States and related areas dataset</h2></a>

<h3>Description</h3>

<p>This data set provides a variety of fields for US States, DC, PR, and Island Areas,
including FIPS codes and area in square miles or square kilometers, for example, from the Census Bureau.
</p>


<h3>Format</h3>

<p>A data.frame with 58 rows (States etc.) and 26 columns (variables like statename). 
See <code><a>get.state.info</a></code> for more details.
</p>

<ul>
<li>
<p>  [1,] "statename"       
</p>
</li>
<li>
<p>  [2,] "FIPS.ST"         
</p>
</li>
<li>
<p>  [3,] "ST"              
</p>
</li>
<li>
<p>  [4,] "ftpname"         
</p>
</li>
<li>
<p>  [5,] "REGION"          
</p>
</li>
<li>
<p>  [6,] "is.usa.plus.pr"  
</p>
</li>
<li>
<p>  [7,] "is.usa"          
</p>
</li>
<li>
<p>  [8,] "is.state"        
</p>
</li>
<li>
<p>  [9,] "is.contiguous.us"
</p>
</li>
<li>
<p> [10,] "is.island.areas" 
</p>
</li>
<li>
<p> [11,] "area.sqmi"       
</p>
</li>
<li>
<p> [12,] "area.sqkm"       
</p>
</li>
<li>
<p> [13,] "landarea.sqmi"   
</p>
</li>
<li>
<p> [14,] "landarea.sqkm"   
</p>
</li>
<li>
<p> [15,] "waterarea.sqmi"  
</p>
</li>
<li>
<p> [16,] "waterarea.sqkm"  
</p>
</li>
<li>
<p> [17,] "inland.sqmi"     
</p>
</li>
<li>
<p> [18,] "inland.sqkm"     
</p>
</li>
<li>
<p> [19,] "coastal.sqmi"    
</p>
</li>
<li>
<p> [20,] "coastal.sqkm"    
</p>
</li>
<li>
<p> [21,] "greatlakes.sqmi" 
</p>
</li>
<li>
<p> [22,] "greatlakes.sqkm" 
</p>
</li>
<li>
<p> [23,] "territorial.sqmi"
</p>
</li>
<li>
<p> [24,] "territorial.sqkm"
</p>
</li>
<li>
<p> [25,] "lat"             
</p>
</li>
<li>
<p> [26,] "lon"  
</p>
</li>
</ul>
<h3>Details</h3>

<p>For information on FIPS codes, see <a href="http://www.census.gov/geo/reference/ansi.html" target="_blank">http://www.census.gov/geo/reference/ansi.html</a>,
and also see <a href="https://www.census.gov/geo/reference/geoidentifiers.html" target="_blank">https://www.census.gov/geo/reference/geoidentifiers.html</a> <br><br>
Regarding Island Areas see <a href="http://www.census.gov/geo/reference/gtc/gtc_island.html" target="_blank">http://www.census.gov/geo/reference/gtc/gtc_island.html</a> which states the following: 
Separate from the Island Areas is the term "U.S. Minor Outlying Islands."  
The Island Areas of the United States are 
American Samoa, Guam, the Commonwealth of the Northern Mariana Islands (Northern Mariana Islands), and the United States Virgin Islands.
The U.S. Minor Outlying Islands refers to certain small islands under U.S. jurisdiction in the Caribbean and Pacific:  
Baker Island, Howland Island, Jarvis Island, Johnston Atoll, Kingman Reef, Midway Islands, Navassa Island, Palmyra Atoll, and Wake Island.  
These areas usually are not part of standard data products.
</p>


<h3>Source</h3>

<p>Derived from <a href="https://www.census.gov/geo/reference/state-area.html" target="_blank">https://www.census.gov/geo/reference/state-area.html</a> (for area data in square miles etc.)
obtained 4/2015, and FIPS codes from Census Bureau, but 
other than the exact areas in square km, this table would be the same for Census 2020.
</p>


<h3>See Also</h3>

<p><code><a>get.state.info</a></code> in <span class="pkg">ejanalysis</span> package (<a href="http://ejanalysis.github.io/ejanalysis/" target="_blank">http://ejanalysis.github.io/ejanalysis/</a>),
and <code><a href="https://r-universe.dev/manuals/datasets.html#state">state.abb</a></code> via <code>data(state)</code>
</p>

<hr>
</div>
<div class="container manual-page" id="meters.per.degree.lat">

<a href="#meters.per.degree.lat" class="help-page-title"><h2>Convert degrees latitude to meters North-South.</h2></a>

<h3>Description</h3>

<p><code>meters.per.degree.lat</code> returns meters traveled North-South per decimal degrees latitude, given latitude (Northern Hemisphere).
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">meters.per.degree.lat<span class="token punctuation">(</span>theta<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>The decimal degrees of latitude of the Northern Hemisphere location(s) of interest, as number or vector of numbers.</p>
</td>
</tr></table>
<h3>Details</h3>

<p>This function returns the meters traveled North-South per decimal degree latitude, at a given latitude (Northern Hemisphere).
This is an approximation and is less accurate further from the given latitude.
Based on 
<a href="http://en.wikipedia.org/wiki/Latitude#Length_of_a_degree_of_latitude" target="_blank">http://en.wikipedia.org/wiki/Latitude#Length_of_a_degree_of_latitude</a> and <br><a href="http://en.wikipedia.org/wiki/Longitude#Length_of_a_degree_of_longitude" target="_blank">http://en.wikipedia.org/wiki/Longitude#Length_of_a_degree_of_longitude</a> <br>
Input theta is latitude on WGS84. <br>
Also see <a href="http://en.wikipedia.org/wiki/Longitude" target="_blank">http://en.wikipedia.org/wiki/Longitude</a> and <a href="http://en.wikipedia.org/wiki/Decimal_degrees" target="_blank">http://en.wikipedia.org/wiki/Decimal_degrees</a> <br></p>


<h3>Value</h3>

<p>Returns meters traveled N-S, as a number or vector of numbers the same length as the input.
</p>


<h3>See Also</h3>

<p><code><a href="#meters.per.degree.lon">meters.per.degree.lon</a></code> for a similar function but for travel East-West, with more detailed explanation/help,
and <code><a href="#get.distances.all">get.distances.all</a></code> and <code><a href="#get.distances">get.distances</a></code> for distances between points, and related functions.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">meters.per.degree.lat<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
meters.per.degree.lat<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">72</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="meters.per.degree.lon">

<a href="#meters.per.degree.lon" class="help-page-title"><h2>Convert degrees longitude to meters East-West.</h2></a>

<h3>Description</h3>

<p><code>meters.per.degree.lon</code> returns meters traveled East-West per decimal degree longitude, given latitude (Northern Hemisphere).
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">meters.per.degree.lon<span class="token punctuation">(</span>theta<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>The decimal degrees of latitude of the Northern Hemisphere location(s) of interest, as number or vector of numbers.</p>
</td>
</tr></table>
<h3>Details</h3>

<p>This function returns the meters traveled East-West per decimal degree longitude, at a given latitude (Northern Hemisphere).
This is an approximation and is less accurate further from the given latitude.
Based on 
<a href="http://en.wikipedia.org/wiki/Latitude#Length_of_a_degree_of_latitude" target="_blank">http://en.wikipedia.org/wiki/Latitude#Length_of_a_degree_of_latitude</a> and <br><a href="http://en.wikipedia.org/wiki/Longitude#Length_of_a_degree_of_longitude" target="_blank">http://en.wikipedia.org/wiki/Longitude#Length_of_a_degree_of_longitude</a> <br><br>
Input theta is latitude on WGS84.
Function is as follows:  <br>
theta.r &lt;- 0.01745329 * theta <br>
ecc2 &lt;- 0.00669438 <br>
return( 20037508 * cos(theta.r) / ( 180 * sqrt(1- ecc2 * (sin(theta.r))^2 ) ) ) <br>
Based on the following calculations: <br>
The equatorial.radius used is 6378137.0 in meters <br>
2 pi / 360 = 0.01745329 <br>
for the WGS84 ellipsoid with a = 6,378,137.0 m and b = 6,356,752.3142 m. <br>
equatorial.radius &lt;-  6378137.0  # a in meters <br>
b=6356752.3142 <br>
ecc2 &lt;- (equatorial.radius^2 - b^2)/equatorial.radius^2  <br>
ecc2 &lt;- (6378137.0^2 - 6356752.3142^2) / 6378137.0^2 <br>
pi * equatorial.radius = 20037508 <br><br>
Also see <a href="http://en.wikipedia.org/wiki/Longitude" target="_blank">http://en.wikipedia.org/wiki/Longitude</a> and <a href="http://en.wikipedia.org/wiki/Decimal_degrees" target="_blank">http://en.wikipedia.org/wiki/Decimal_degrees</a>
</p>


<h3>Value</h3>

<p>Returns meters traveled East-West per decimal degree longitude, as a number or vector of numbers the same length as the input.
</p>


<h3>See Also</h3>

<p><code><a href="#meters.per.degree.lat">meters.per.degree.lat</a></code> for a similar function but for travel North-South,
and <code><a href="#deltalon.per.km">deltalon.per.km</a></code> for the inverse of this function (other than a factor of 1000),
and <code><a href="#get.distances.all">get.distances.all</a></code> and also <code><a href="#get.distances">get.distances</a></code> to get distances between points, and related functions.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">meters.per.degree.lon<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
meters.per.degree.lon<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">72</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="near_eachother">

<a href="#near_eachother" class="help-page-title"><h2>which points are near any of the others in list?</h2></a>

<h3>Description</h3>

<p>which points are near any of the others in list?
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">near_eachother<span class="token punctuation">(</span>lon<span class="token punctuation">,</span> lat<span class="token punctuation">,</span> distance<span class="token punctuation">,</span> or_tied <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>longitude</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>latitude</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distance</code></td>
<td>
<p>distance between points in miles to check</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>or_tied</code></td>
<td>
<p>if TRUE, checks if less than or equal to distance, otherwise if less than</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="pointmap">

<a href="#pointmap" class="help-page-title"><h2>Read a series of dbf files and join compile them as a single data.frame</h2></a>

<h3>Description</h3>

<p>Can help with a series of downloaded Census data files, such as one file per State. 
Reads each using <code><a href="https://r-universe.dev/manuals/foreign.html#read.dbf">read.dbf</a></code> and combines them all as a data.frame.
They must all have the same columns, and each file just provides additional rows of data.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">pointmap<span class="token punctuation">(</span>
  bin<span class="token punctuation">,</span>
  lat<span class="token punctuation">,</span>
  lon<span class="token punctuation">,</span>
  vartext <span class="token operator">=</span> <span class="token string">"x"</span><span class="token punctuation">,</span>
  areatext <span class="token operator">=</span> <span class="token string">"area"</span><span class="token punctuation">,</span>
  coloring <span class="token operator">=</span> rainbow<span class="token punctuation">(</span>length<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>bin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  asp <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  pch <span class="token operator">=</span> <span class="token string">"."</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>bin</code></td>
<td>
<p>Indicates color of each point. A vector of integers used to index the coloring vector. That would ideally include just 1:n where n is the n number of unique values and the index to the coloring vector, so each unique value 1:5, for example, is assigned a map color that is coloring[bin]</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>vector of latitudes just interpreted as y values to plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>vector of longitudes just interpreted as x values to plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vartext</code></td>
<td>
<p>default is 'x', text to use in describing the field mapped</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>areatext</code></td>
<td>
<p>default is 'area', text to use in describing the area mapped</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coloring</code></td>
<td>
<p>default is some basic colors from rainbow(). A vector specifying color for each bin (should be same length as number of unique bin values)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>asp</code></td>
<td>
<p>default is c(1,1), aspect ratio of graphic (not right for AK, e.g.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pch</code></td>
<td>
<p>default is '.', see <code><a href="https://r-universe.dev/manuals/graphics.html#par">par</a></code>  defines type of marker for each point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other params to send to plot</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Draws a map
</p>


<h3>See Also</h3>

<p><code><a href="#countypointmap">countypointmap</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">myfips <span class="token operator">&lt;-</span> bg.pts<span class="token operator">$</span>FIPS<span class="token punctuation">[</span>substr<span class="token punctuation">(</span>bg.pts<span class="token operator">$</span>FIPS<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">'06'</span><span class="token punctuation">]</span> <span class="token comment"># CA</span>
  pointmap<span class="token punctuation">(</span>bin <span class="token operator">=</span> floor<span class="token punctuation">(</span>runif<span class="token punctuation">(</span>n <span class="token operator">=</span> length<span class="token punctuation">(</span>myfips<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5.99</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lat <span class="token operator">=</span> bg.pts<span class="token operator">$</span>lat<span class="token punctuation">[</span>match<span class="token punctuation">(</span>myfips<span class="token punctuation">,</span> bg.pts<span class="token operator">$</span>FIPS<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lon <span class="token operator">=</span> bg.pts<span class="token operator">$</span>lon<span class="token punctuation">[</span>match<span class="token punctuation">(</span>myfips<span class="token punctuation">,</span> bg.pts<span class="token operator">$</span>FIPS<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vartext <span class="token operator">=</span> <span class="token string">'Example'</span><span class="token punctuation">,</span> areatext <span class="token operator">=</span> <span class="token string">'all of CA'</span><span class="token punctuation">,</span>coloring <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'gray'</span><span class="token punctuation">,</span> <span class="token string">'light blue'</span><span class="token punctuation">,</span> <span class="token string">'dark blue'</span><span class="token punctuation">,</span> <span class="token string">'orange'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> pch<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> cex<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="proxistat">

<a href="#proxistat" class="help-page-title"><h2>Proximity Statistic for Each Location and Nearby Points</h2></a>

<h3>Description</h3>

<p>Calculate proximity statistic for each location,
quantifying number of and proximities of nearby points.
<code>proxistat</code> returns a proximity statistic (score) for each location (e.g., Census block).
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">proxistat<span class="token punctuation">(</span>
  frompoints<span class="token punctuation">,</span>
  topoints<span class="token punctuation">,</span>
  area <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  radius <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
  units <span class="token operator">=</span> <span class="token string">"km"</span><span class="token punctuation">,</span>
  decay <span class="token operator">=</span> <span class="token string">"1/d"</span><span class="token punctuation">,</span>
  wts<span class="token punctuation">,</span>
  return.count <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  return.nearest <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  FIPS<span class="token punctuation">,</span>
  pop<span class="token punctuation">,</span>
  testing <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  dfunc <span class="token operator">=</span> <span class="token string">"sp"</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>frompoints</code></td>
<td>
<p>Locations of internal points of Census subunits. 
A matrix or data.frame with two cols, 'lat' and 'lon' with datum=WGS84 assumed. Decimal degrees. Required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>topoints</code></td>
<td>
<p>Locations of nearby points of interest, proximity to which is the basis of each Census unit's score. 
A matrix or data.frame with two cols, 'lat' and 'lon' with datum=WGS84 assumed. Decimal degrees. Required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>area</code></td>
<td>
<p>A number or vector of numbers giving size of each spatial unit with FIPS.pop, 
in square miles or square kilometers depending on the <code>units</code> parameter. Optional. 
Default is 0, in which case no adjustment is made for small or even zero distance, 
which can cause unrealistically large or even infinite/undefined scores. For zero distance if area=0, Inf will be returned for the score.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>NOTE: This default is not the same as the default in <code><a href="#get.distances">get.distances</a></code>! 
Optional, a number giving distance defining nearby, i.e. the search radius, 
in km or miles depending on the codeunits parameter. Default is 5 (km if units='km'). Max is 5200 miles (roughly the distance from Hawaii to Maine).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>units</code></td>
<td>
<p>A string that is 'miles' or 'km' for kilometers (default is 'km'), specifying units for distances returned and for radius input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>decay</code></td>
<td>
<p>A string specifying type of function to use when weighting by distance. The Default is '1/d'
For '1/d' decay weighting (default), score is count of points within radius, divided by harmonic mean of distances (when count&gt;0).
Decay weighting also can be '1/d^2' or '1/1' to represent decay by inverse of squared distance, or no decay (equal weighting for all points).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wts</code></td>
<td>
<p>Optional vector of numbers same length as number of topoints. 
If wts is specified, the score for each of the frompoints will be the weighted sum of influences of topoints. 
For example, if decay='1/d' (default), proximity score = sum(wts/d) for all the topoints nearby. 
If decay='1/1', proximity score = sum(wts) for all the topoints nearby.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.count</code></td>
<td>
<p>Optional, logical, defaults to FALSE, specifies if results returned should include a column with the count of topoints that were within radius, for each of the frompoints</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.nearest</code></td>
<td>
<p>Optional, logical, defaults to FALSE, specifies if results returned should include a column with the distance to the nearest single of the topoints, for each of the frompoints</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FIPS</code></td>
<td>
<p>NOT USED CURRENTLY - COULD BE USED LATER TO AGGREGATE (rollup) TO BLOCK GROUPS FROM BLOCKS, FOR EXAMPLE. 
A vector of strings designating places that will be assigned scores where each is the Census FIPS code or other ID. Optional.
Might want to have this be a factor not string to be faster, or ensure it is indexed on fips, or have separate FIPS.BG passed to this function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pop</code></td>
<td>
<p>NOT USED CURRENTLY - COULD BE USED LATER TO AGGREGATE (rollup) TO BLOCK GROUPS FROM BLOCKS, FOR EXAMPLE. 
A number or vector of numbers giving population count of each spatial unit. 
Default is 1, which would give the unweighted average.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testing</code></td>
<td>
<p>Logical during work in progress</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dfunc</code></td>
<td>
<p>Optional character element hf or slc to specify distance function Haversine or spherical law of cosines.
If sp (default, fastest), it uses the <span class="pkg">sp</span> package to find distances more accurately and more quickly.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This uses <code><a href="#get.distances">get.distances</a></code> with return.crosstab=TRUE.
This function returns a vector of proximity scores, one for each location such as a Census block.
For example, the proximity score may be used to represent how many hazardous waste sites are near any given neighborhood and how close they are.
A proximity score quantifies the proximity and count of nearby points using a specified formula. <br>
Proximity Score = distance-weighted count of points nearby (within search radius) (or with another optional weight for each topoint) <br>
(or weighted distance to nearest single point if there are none within the radius). <br>
This is the sum of 1/d or 1/d^2 or 1/1, depending on the decay weighting, (or with another optional weight for each topoint instead of the number 1)
where d is the distance from census unit's internal point to user-defined point.
The default proximity score, using 1/d, is the count of nearby points divided by the harmonic mean of their distances (n/harmean), 
(but adjusted when distance is very small, and using the nearest single one if none are nearby). 
This is the same as the sum of inverse distances. 
Note that Inf is returned as score if 1/d used and distance is ever 0 like where to and from are same point. Does not do a 1/d score for only the ones at nonzero distance. 
The harmonic mean distance (see <code><a>harmean</a></code>) is the inverse of the arithmetic mean of the inverses, or n / (sum of inverses). <br><br>
Nearby is defined as a user-specified parameter, so only points within the specified distance are counted, except if none are nearby,
the single nearest point (at any distance) is used. <br><br>
Default relies on the <span class="pkg">sp</span> package for the <code><a href="https://edzer.r-universe.dev/sp/doc/manual.html#spDistsN1">spDistsN1</a></code> and <code><a href="https://edzer.r-universe.dev/sp/doc/manual.html#SpatialPoints">SpatialPoints</a></code> functions.
Other values of dfunc parameter are slower. <br><br>
IMPORTANT: <br><br>
To create a proximity score for a block group, one can find the score for each block in the block group
and then find the population-weighted average of those block scores, for a single block group. <br>
FIPS for blocks can be used to find FIPS for block groups. FIPS for block groups can be used to find FIPS for tracts. <br><br>
ADJUSTMENT FOR SMALL DISTANCES:  <br><br>
The adjustment for small distances ensure that each distance represents roughly the distance to the average resident within a spatial unit like a block,
rather than just the distance to the center or internal point. 
The adjustment uses the area of the spatial unit and assumes residents are evenly spread across the unit.
Distance is adjusted in each place if area of each spatial unit is specified, to ensure it represents roughly distance to average resident in the unit:
The distance is capped to be no less than 0.9 x radius of a circle of area equal to census unit's area.
This approximation treats unit as if it were a circle and assumes pop is evenly distributed within that circle's area, since <br>
0.9r = 0.9 x sqrt(area/pi) = approx solution to dist from avg point (resident) in circle
to a random point in the circle (facility or point of interest).
The use of a minimum distance per areal unit is intended to help approximate the distance from the average resident 
rather than from the internal point or center of the areal unit. The approximation assumes distance to the average resident can be estimated 
as if homes and facilities were on average uniformly distributed within blocks (or whatever units are used) that were roughly circular on average.
It relies on the fact that the average distance between two random points in a circle of radius R is 90 percent of R 
(Weisstein, Eric W. Disk Line Picking. From MathWorldA Wolfram Web Resource. <a href="http://mathworld.wolfram.com/DiskLinePicking.html" target="_blank">http://mathworld.wolfram.com/DiskLinePicking.html</a> ). 
This means that if a population is randomly spread over a roughly circular block, a facility inside the block (i.e., very close to the internal point)
typically would be 0.9R from the average person. The same math shows that the average point in the circle is 0.67R from the center, 
and 1.13R from the edge of the circle. We can describe this relationship using an equation that is a portion of the formula for the 
distance between two random points in a circle of radius = 1. The formula uses b = the distance of the facility from the center as a fraction of the radius, 
and the integral over a represents distances of residences from the center. 
We can solve the equation using <a href="http://WolframAlpha.com" target="_blank">http://WolframAlpha.com</a>, for b = 0, 0.5, or 1, representing points at the center, halfway to the edge, 
and at the edge of the circle. For example, we can use this equation for b = 0.5 to find that the average person, if randomly located in a circle of radius R, 
is a distance of about 0.8 R from a facility that is halfway between the center and edge of the circle. 
Note this is not the same as the expected location of a randomly placed facility, which would use b = sqrt(0.5) instead and gives a distance of about 0.9R. 
The following would be used as the input to WolframAlpha to derive the 0.9 approximation: 
Integrate((1/Pi) Sqrt(a + (Sqrt(0.5))^2 - 2(Sqrt(0.5)) Sqrt(a) cos(t)), a,  0,  1,  t, 0, pi)
<a href="http://bit.ly/1GJ9UID" target="_blank">http://bit.ly/1GJ9UID</a>
</p>


<h3>Value</h3>

<p>By default, returns a vector of numbers, the proximity scores, one for each of the frompoints (or if testing, a matrix with 2 columns: fromrow and d for distance).
Based on miles by default, or km depending on units. 
Returns +Inf for a unit if that area's area and distance are both zero.
</p>


<h3>See Also</h3>

<p><code><a href="#get.distances">get.distances</a></code> and <code><a href="#get.distances.all">get.distances.all</a></code> for distances between points, and
<code><a href="#get.nearest">get.nearest</a></code> which finds the distance to the single nearest point
within a specified search radius instead of all topoints.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">test.from <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>fromlat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9567309094</span><span class="token punctuation">,</span> <span class="token number">38.9507043428</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  fromlon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0896572305</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0896199948</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> <span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"6054762"</span><span class="token punctuation">,</span> <span class="token string">"6054764"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">)</span>
test.to <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>tolat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38.9575019287</span><span class="token punctuation">,</span> <span class="token number">38.9507043428</span><span class="token punctuation">,</span> <span class="token number">38.9514152435</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  tolon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.0892818598</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0896199948</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77.0972395245</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> <span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"6054762"</span><span class="token punctuation">,</span> <span class="token string">"6054763"</span><span class="token punctuation">,</span> <span class="token string">"6054764"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

set.seed<span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span>
t1<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
t10<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># t1=t10[3,] </span>
t100<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment"># t10[2,] &lt;- t100[5,] </span>
t1k<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e3</span><span class="token punctuation">)</span>
t10k<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e4</span><span class="token punctuation">)</span>
t100k<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e5</span><span class="token punctuation">)</span>
t1m<span class="token operator">=</span>testpoints<span class="token punctuation">(</span><span class="token number">1e6</span><span class="token punctuation">)</span>

proxistat<span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t10k<span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>

proxistat<span class="token punctuation">(</span>t10<span class="token punctuation">,</span> t10k<span class="token punctuation">)</span>

subunitscores <span class="token operator">=</span> proxistat<span class="token punctuation">(</span>frompoints<span class="token operator">=</span>test.from<span class="token punctuation">,</span> topoints<span class="token operator">=</span>test.to<span class="token punctuation">,</span>
  area<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>test.from<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">'km'</span><span class="token punctuation">)</span>
print<span class="token punctuation">(</span>subunitscores<span class="token punctuation">)</span>
subunitpop <span class="token operator">=</span> rep<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>test.from<span class="token operator">$</span>lat<span class="token punctuation">)</span><span class="token punctuation">)</span>
subunits <span class="token operator">=</span> data.frame<span class="token punctuation">(</span>FIPS<span class="token operator">=</span>substr<span class="token punctuation">(</span>rownames<span class="token punctuation">(</span>test.from<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  pop<span class="token operator">=</span>subunitpop<span class="token punctuation">,</span> stringsAsFactors<span class="token operator">=</span><span class="token boolean">FALSE</span> <span class="token punctuation">)</span>
unitscores <span class="token operator">=</span> aggregate<span class="token punctuation">(</span>subunits<span class="token punctuation">,</span>
  by<span class="token operator">=</span>list<span class="token punctuation">(</span>subunits<span class="token operator">$</span>FIPS<span class="token punctuation">)</span><span class="token punctuation">,</span> FUN<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>Hmisc<span class="token operator">::</span>wtd.mean<span class="token punctuation">(</span>x<span class="token operator">$</span>score<span class="token punctuation">,</span> weights<span class="token operator">=</span>x<span class="token operator">$</span>pop<span class="token punctuation">,</span> na.rm<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>unitscores<span class="token punctuation">)</span>
<span class="token comment">## Not run: </span>
output <span class="token operator">=</span> proxistat.chunked<span class="token punctuation">(</span>blocks<span class="token punctuation">[</span> <span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">'lon'</span><span class="token punctuation">,</span><span class="token string">'lat'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> topoints<span class="token operator">=</span>rmp<span class="token punctuation">,</span> fromchunksize<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">,</span> area<span class="token operator">=</span>blocks<span class="token operator">$</span>area <span class="token operator">/</span> <span class="token number">1e6</span><span class="token punctuation">,</span>
   return.count<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> return.nearest<span class="token operator">=</span><span class="token boolean">TRUE</span> <span class="token punctuation">)</span>
output<span class="token operator">=</span>as.data.frame<span class="token punctuation">(</span>output<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>class<span class="token punctuation">(</span>blocks<span class="token operator">$</span>fips<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token string">'character'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>blocks<span class="token operator">$</span>fips <span class="token operator">&lt;-</span> lead.zeroes<span class="token punctuation">(</span>blocks<span class="token operator">$</span>fips<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
blocks<span class="token operator">$</span>FIPS.BG <span class="token operator">&lt;-</span> get.fips.bg<span class="token punctuation">(</span>blocks<span class="token operator">$</span>fips<span class="token punctuation">)</span>
bg.proxi <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span><span class="token punctuation">)</span>
bg.proxi<span class="token operator">$</span>scores  <span class="token operator">&lt;-</span>  aggregate<span class="token punctuation">(</span> cbind<span class="token punctuation">(</span>d<span class="token operator">=</span>output<span class="token operator">$</span>scores<span class="token punctuation">,</span> pop<span class="token operator">=</span>blocks<span class="token operator">$</span>pop<span class="token punctuation">)</span><span class="token punctuation">,</span> by<span class="token operator">=</span>list<span class="token punctuation">(</span>blocks<span class="token operator">$</span>FIPS.BG<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> Hmisc<span class="token operator">::</span>wtd.mean<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'nearestone.d'</span> <span class="token percent-operator operator">%in%</span> colnames<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> bg.proxi<span class="token operator">$</span>nearestone.d <span class="token operator">&lt;-</span> aggregate<span class="token punctuation">(</span> output<span class="token operator">$</span>d<span class="token punctuation">,</span> by<span class="token operator">=</span>list<span class="token punctuation">(</span>blocks<span class="token operator">$</span>FIPS.BG<span class="token punctuation">)</span><span class="token punctuation">,</span> min<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'count.near'</span> <span class="token percent-operator operator">%in%</span> colnames<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token punctuation">{</span> bg.proxi<span class="token operator">$</span>count.near   <span class="token operator">&lt;-</span> aggregate<span class="token punctuation">(</span> cbind<span class="token punctuation">(</span>d<span class="token operator">=</span>output<span class="token operator">$</span>count.near<span class="token punctuation">,</span> pop<span class="token operator">=</span>blocks<span class="token operator">$</span>pop<span class="token punctuation">)</span><span class="token punctuation">,</span> by<span class="token operator">=</span>list<span class="token punctuation">(</span>blocks<span class="token operator">$</span>FIPS.BG<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> Hmisc<span class="token operator">::</span>wtd.mean<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="proxistat.assemble.chunks">

<a href="#proxistat.assemble.chunks" class="help-page-title"><h2>read files storing proxistat result chunks and assemble into one result</h2></a>

<h3>Description</h3>

<p>read files storing proxistat result chunks and assemble into one result
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">proxistat.assemble.chunks<span class="token punctuation">(</span>files<span class="token punctuation">,</span> folder <span class="token operator">=</span> getwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>files</code></td>
<td>
<p>Required character vector of names of .RData files to read and combine</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>folder</code></td>
<td>
<p>Optional character element specifying directory where files are stored, defaults to getwd()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Matrix that contains combined results found in all the files
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 fnames<span class="token operator">=</span>proxistat.chunked<span class="token punctuation">(</span>testpoints<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> testpoints<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fromchunksize <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> assemble<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span> 
   folder<span class="token operator">=</span>file.path<span class="token punctuation">(</span>getwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'temp'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 output<span class="token operator">=</span>proxistat.assemble.chunks<span class="token punctuation">(</span>files<span class="token operator">=</span>fnames<span class="token punctuation">,</span> folder<span class="token operator">=</span>file.path<span class="token punctuation">(</span>getwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'temp'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="proxistat.chunked">

<a href="#proxistat.chunked" class="help-page-title"><h2>Call proxistat once per chunk &amp; save output as file (breaks large input data into chunks)</h2></a>

<h3>Description</h3>

<p>Call proxistat function in chunks, when list of frompoints is so long it taxes RAM (e.g. 11m blocks),
saving each chunk as a separate .RData file in current working directory
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">proxistat.chunked<span class="token punctuation">(</span>
  frompoints<span class="token punctuation">,</span>
  topoints<span class="token punctuation">,</span>
  fromchunksize<span class="token punctuation">,</span>
  tochunksize<span class="token punctuation">,</span>
  startchunk <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  FUN <span class="token operator">=</span> proxistat<span class="token punctuation">,</span>
  folder <span class="token operator">=</span> getwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  savechunks <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  assemble <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  saveproxistats <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  area<span class="token punctuation">,</span>
  file <span class="token operator">=</span> <span class="token string">"proxistats.RData"</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>frompoints</code></td>
<td>
<p>Require matrix or data.frame of lat/lon vauels that can be passed to get.distances function (colnames 'lat' and 'lon')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>topoints</code></td>
<td>
<p>Require matrix or data.frame of lat/lon vauels that can be passed to get.distances function (colnames 'lat' and 'lon')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fromchunksize</code></td>
<td>
<p>Required, number specifying how many points to analyze at a time (per chunk).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tochunksize</code></td>
<td>
<p>(not currently required - current default is to use all topoints at once) number specifying how many points to analyze at a time (per chunk).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>startchunk</code></td>
<td>
<p>Optional integer defaults to 1. Specifies which chunk to start with, in case some already have been done. 
Currently, still must pass entire dataset to this function even if some of the earlier chunks have already been analyzed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FUN</code></td>
<td>
<p>Optional function, <code><a href="#proxistat">proxistat</a></code> by default, and other values not implemented yet.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>folder</code></td>
<td>
<p>Optional path specifying where to save .RData file(s)  chunk-specific files and/or assembled results file  default is getwd()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>savechunks</code></td>
<td>
<p>Optional logical defaults to FALSE. Specifies whether to save .RData file of each chunk</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assemble</code></td>
<td>
<p>Optional logical defaults to TRUE. Specifies whether to assemble all chunks into one variable called proxistats, 
which is saved as <code>file</code> in <code>folder</code> and returned by this function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveproxistats</code></td>
<td>
<p>Optional logical defaults to FALSE. Specifies whether to save .RData file of assembled results as proxistats matrix. Ignored if assemble=FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>area</code></td>
<td>
<p>Optional number or vector of numbers giving size of each spatial unit with FIPS.pop, 
in square miles or square kilometers depending on the <code>units</code> parameter. Optional. 
Default is to pass nothing to proxistat, and default there is 0, in which case no adjustment is made for small or even zero distance, 
which can cause unrealistically large or even infinite/undefined scores. For zero distance if area=0, Inf will be returned for the score.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>Optional name of file created if assemble=TRUE and saveproxistats=TRUE, defaults to proxistats.RData using save(proxistats, 'proxistats.RData')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other parameters to pass to <code><a href="#proxistat">proxistat</a></code> such as <code>units</code> or <code>wts</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>*** Still slow for all blocks in USA &amp; 10k topoints (several hours)
Filesizes: <br><br>
80MB file/chunk if   1k blocks x 11k topoints/chunk:  y=get.distances.chunked(testpoints(11e6), testpoints(11000), 1e3, units='km') <br><br>
800MB file/chunk if 10k blocks x 11k topoints/chunk:  y=get.distances.chunked(testpoints(11e6), testpoints(11000), 1e4, units='km')
</p>


<h3>Value</h3>

<p>If assemble=TRUE, returns assembled set of all chunks as matrix of 1 or more columns.
If assemble=FALSE but savechunks=TRUE, returns vector of character elements that are filenames for saved .RData output files in current working directory or specified folder.
Each saved output is a vector of proximity scores if FUN=proxistat, or matrix with extra columns depending on return. parameters above.
Otherwise, returns NULL.
</p>

<hr>
</div>
<div class="container manual-page" id="proxistat.rollup">

<a href="#proxistat.rollup" class="help-page-title"><h2>Convert Census Block Proximity Statistics to Block Group Statistics</h2></a>

<h3>Description</h3>

<p>Aggregate proximity statistics already calculated for each Census block, up to one summary for each Census block group. 
The resulting proximity score, distance to nearest single point, or count of nearby points is just the 
population-weighted mean of values in the blocks within a given block group.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">proxistat.rollup<span class="token punctuation">(</span>output<span class="token punctuation">,</span> blocksfips<span class="token punctuation">,</span> blocksfipsbg<span class="token punctuation">,</span> blockspop<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>output</code></td>
<td>
<p>Required matrix of results from <code><a href="#proxistat">proxistat</a></code> or <code><a href="#proxistat.chunked">proxistat.chunked</a></code>. Must be same number of rows and order as blocksfips.
Output parameter must be output of proxistat or proxistat.chunked and contain the colname scores, and can also have colnames nearestone.d and/or count.near.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocksfips</code></td>
<td>
<p>Required character vector of 15-digit Census block FIPS codes (not numeric, must have leading zeroes as needed).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocksfipsbg</code></td>
<td>
<p>Required character vector of 12-digit Census block group FIPS codes (not numeric, must have leading zeroes as needed). Same length and order as blocksfips.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blockspop</code></td>
<td>
<p>Required numeric vector of population counts in Census blocks. Same length and order as blocksfips.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The population-weighted mean might not be the only statistic of interest. <br>
To get the maximum count of sites near any single block in the block group, try         aggregate(output[ , 'count.near'],   by=list(blocks$FIPS.BG), FUN=max). <br>
To get the shortest distance from any block in the block group to the nearest site, try aggregate(output[ , 'nearestone.d'], by=list(blocks$FIPS.BG), FUN=min). <br>
To find out how many unique sites are within X km of the internal point of any block in the block group, for example, 
is harder, because it requires retaining details on which sites were near a given block, i.e., much more data would be the input to an aggregating function.
</p>


<h3>Value</h3>

<p>Returns a data.frame with FIPS.BG and same fields proxistat can provide (depending on what is in the parameter called output): scores, nearestone.d, count.near, but with one row for each of the block groups defined by FIPS.BG. 
Units (miles or km) are unchanged from those used to create input parameters.
</p>


<h3>See Also</h3>

<p><code><a href="#proxistat">proxistat</a></code> and <code><a href="#proxistat.chunked">proxistat.chunked</a></code> to create proximity statistics, 
and see <code><a href="#get.distances">get.distances</a></code> and <code><a href="#get.distances.all">get.distances.all</a></code> for distances between points, and
<code><a href="#get.nearest">get.nearest</a></code> which finds the distance to the single nearest point
within a specified search radius instead of all topoints. 
See also <code><a>rollup</a></code> via <a href="http://ejanalysis.github.io/ejanalysis/" target="_blank">http://ejanalysis.github.io/ejanalysis/</a>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment"># require(Hmisc); require(data.table)</span>
<span class="token comment"># require("devtools") # to obtain packages via devtools::github_install()</span>
<span class="token comment">#  These are on github.com/ejanalysis, e.g.  https://github.com/ejanalysis/UScensus2010blocks</span>
<span class="token comment"># require(analyze.stuff); require(ejanalysis)</span>
<span class="token comment"># require(UScensus2010blocks) # for the get.blocks() function and dataset</span>
<span class="token comment"># blocks &lt;- UScensus2010blocks::get.blocks()</span>
<span class="token comment"># bgp &lt;- proxistat.rollup(output=output, blocksfips=blocks$fips, blocksfipsbg=blocks$FIPS.BG, blockspop=blocks$pop)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="speedsummary">

<a href="#speedsummary" class="help-page-title"><h2>Print summary of speed in buffers per hour, given start and end times of batch</h2></a>

<h3>Description</h3>

<p>Print summary of speed in buffers per hour, given start and end times of batch
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">speedsummary<span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> n<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p>time when finished from Sys.time()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end</code></td>
<td>
<p>time when finished from Sys.time()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>how many buffers were done?</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Prints to console and returns rate of buffers per hour
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 pts <span class="token operator">&lt;-</span> proxistat<span class="token operator">::</span>testpoints_block2010<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
 benchmark.start <span class="token operator">&lt;-</span> Sys.time<span class="token punctuation">(</span><span class="token punctuation">)</span>
 outlist <span class="token operator">&lt;-</span> batch.summarizer<span class="token operator">::</span>ejscreenapi<span class="token punctuation">(</span>pts<span class="token operator">$</span>lon<span class="token punctuation">,</span> lat<span class="token operator">=</span>pts<span class="token operator">$</span>lat<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
 benchmark.end <span class="token operator">&lt;-</span> Sys.time<span class="token punctuation">(</span><span class="token punctuation">)</span>
 proxistat<span class="token operator">::</span>speedsummary<span class="token punctuation">(</span>benchmark.start<span class="token punctuation">,</span> benchmark.end<span class="token punctuation">,</span> NROW<span class="token punctuation">(</span>pts<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="testpoints">

<a href="#testpoints" class="help-page-title"><h2>Generate a number of randomly placed points, as latitude/longitude values.</h2></a>

<h3>Description</h3>

<p>Generate a number of randomly placed points, as latitude/longitude values.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">testpoints<span class="token punctuation">(</span>
  n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  weighting <span class="token operator">=</span> <span class="token string">"area"</span><span class="token punctuation">,</span>
  ST<span class="token punctuation">,</span>
  as.df <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  minlat <span class="token operator">=</span> <span class="token number">17.9</span><span class="token punctuation">,</span>
  maxlat <span class="token operator">=</span> <span class="token number">71.25</span><span class="token punctuation">,</span>
  minlon <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">175.89</span><span class="token punctuation">,</span>
  maxlon <span class="token operator">=</span> <span class="token number">178.34</span><span class="token punctuation">,</span>
  useblocks <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Numeric value, 1 by default. Specifies how many testpoints to return. 
Must be an integer between zero and 50 million, and not NA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighting</code></td>
<td>
<p>area or people or geo or degrees   text indicating what type of weighting, 
by area or people or geo (each block or block group has equal chance).
Default is area - a random square mile not a random residence or random Census geometry.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ST</code></td>
<td>
<p>optional vector of 2 letter state abbreviations, to limit it to some state(s). 
Default is all USA (including PR I think).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as.df</code></td>
<td>
<p>Logical, default is TRUE, in which case returns a data.frame, 
otherwise a matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minlat</code></td>
<td>
<p>the minimum latitude in decimal degrees to use for generating 
random points within some range.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxlat</code></td>
<td>
<p>the maximum latitude in decimal degrees to use for generating 
random points within some range.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minlon</code></td>
<td>
<p>the minimum longitude in decimal degrees to use for generating 
random points within some range.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxlon</code></td>
<td>
<p>the maximum longitude in decimal degrees to use for generating 
random points within some range.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useblocks</code></td>
<td>
<p>logical, whether to use the several million Census blocks if TRUE 
(2020 Census as of 11/2022)
or just the approx 220k block groups (from github package ejscreen) if FALSE which is faster</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function returns n points at random location latitude and longitude values, 
weighted by area or by population count in block group, to be roughly representative of 
either a random location (like throwing a dart, equal weight per square mile of land area
- does not include water area in weighting but 
can return a point in water if bg has internal point in water?!)
or where a randomly selected US resident lives (population weighted).
Points are returned as latitude and longitude in decimal degrees. 
</p>
<p>For people weighted, it picks from the Census blockgroup internal points, 
which are much more representative of where people live than a random square mile would be.
</p>


<h3>Value</h3>

<p>By default, returns a data.frame (or matrix if as.df=FALSE) that has 2 columns: 
lat and lon, in decimal degrees, with 1 row per point.
</p>


<h3>See Also</h3>

<p><code><a href="#get.distances.all">get.distances.all</a></code> which allows you to get distances between all points,
<code><a href="#get.distances.prepaired">get.distances.prepaired</a></code> for finding distances 
when data are already formatted as pairs of points,
<code><a href="#get.nearest">get.nearest</a></code> which finds the distance to the single nearest point 
within a specified search radius instead of all topoints, and 
<code><a href="#proxistat">proxistat</a></code> which calculates a proximity score for each spatial unit 
based on distances to nearby points.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">testpoints<span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span>minlat<span class="token operator">=</span><span class="token number">47</span><span class="token punctuation">,</span>maxlat<span class="token operator">=</span><span class="token number">48</span><span class="token punctuation">)</span>
get.distances<span class="token punctuation">(</span>testpoints<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>testpoints<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">999</span><span class="token punctuation">,</span>return.rownums<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>return.latlons<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="testpoints_bg22">

<a href="#testpoints_bg22" class="help-page-title"><h2>Get lat lon for random US census block groups (where avg person lives or other weighting)</h2></a>

<h3>Description</h3>

<p>Get lat lon for random US census block groups (where avg person lives or other weighting)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">testpoints_bg22<span class="token punctuation">(</span>size<span class="token punctuation">,</span> popwtd <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>size</code></td>
<td>
<p>number of unique test points needed (no duplicates will be returned)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popwtd</code></td>
<td>
<p>default is TRUE, and pop weighted points represent block group where the avg US resident lives.
If FALSE, unweighted, so each block group has equal chance of being selected.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Note this is not optimized for speed. can be slow if pop wtd. 
May recode this to allow wts to be pop, area, or none (no weight).
Area weighted would mean a random location means each square meter is equally likely to be picked, 
like throwing a dart at a map except it is rounded to the nearest internal point. 
Since block groups generally almost all tend to have somewhat similar pop counts,
popwtd and bg fips wtd are not all that different. But square meters varies a lot, 
so area weighted is very different than pop or fips weighted.
</p>


<h3>Value</h3>

<p>data.frame with columns lon and lat, in decimal degrees
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#library(jsonlite)</span>
<span class="token comment">#library(httr)</span>
<span class="token comment">#library(tidyverse) # need magrittr</span>
<span class="token comment">#library(data.table)</span>
<span class="token comment">#library(sf)</span>
<span class="token comment"># pts &lt;- proxistat::testpoints_bg22(10)</span>
<span class="token comment"># benchmark.start &lt;- Sys.time()</span>
<span class="token comment"># outlist &lt;- batch.summarizer::ejscreenapi(pts$lon, lat=pts$lat, radius = 5)</span>
<span class="token comment"># benchmark.end &lt;- Sys.time()</span>
<span class="token comment"># proxistat::speedsummary(benchmark.start, benchmark.end, NROW(pts))</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="testpoints_block2010">

<a href="#testpoints_block2010" class="help-page-title"><h2>Get lat lon for random US census blocks (where avg person lives or other weighting)</h2></a>

<h3>Description</h3>

<p>Note the 2010 version of this is not optimized for speed- it can take 30 seconds to pick just 1,000 points if pop wtd. 
May recode this to allow wts to be pop (using blocks.pop), or area (using blocks.area), or none (no weight).
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">testpoints_block2010<span class="token punctuation">(</span>size<span class="token punctuation">,</span> popwtd <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>size</code></td>
<td>
<p>number of unique test points needed (no duplicates will be returned)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popwtd</code></td>
<td>
<p>default is TRUE, and pop weighted block points represent where the avg US resident lives.
If FALSE, unweighted, so each block has equal chance of being selected.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This is probably obsolete at this point.
</p>


<h3>Value</h3>

<p>data.frame with columns lon and lat, in decimal degrees
</p>

<hr>
</div>
<div class="container manual-page" id="testpoints_block2020">

<a href="#testpoints_block2020" class="help-page-title"><h2>Get lat lon pop and area for random US census blocks (where avg person lives or other weighting)</h2></a>

<h3>Description</h3>

<p>Get lat lon pop and area for random US census blocks (where avg person lives or other weighting)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">testpoints_block2020<span class="token punctuation">(</span>size<span class="token punctuation">,</span> weighting <span class="token operator">=</span> <span class="token string">"area"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>size</code></td>
<td>
<p>number of unique test points needed (no duplicates will be returned)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighting</code></td>
<td>
<p>is "people" for average resident; or "block" for average census block,
or "area" for average square meter 
If FALSE, unweighted, so each block has equal chance of being selected.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>data.frame with columns lon and lat, in decimal degrees, and area and pop count
</p>

<hr>
</div>
</div>
    <footer><p>Rendered with postdoc 1.2.2</p></footer>
  </body>
</html>
